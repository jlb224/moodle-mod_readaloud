define(["jquery","core/log","mod_readaloud/definitions","core/str","core/ajax","core/notification"],function(a,b,c,d,e,f){"use strict";return b.debug("Click to hear: initialising"),{controls:{},ready:!1,remotetranscribe:!1,attemptid:0,checking:"... checking ...",secstillcheck:"Checking again in: ",notgradedyet:"Your reading has not been evaluated yet.",evaluated:"Your reading has been evaluated.",init:function(a){this.attemptid=a.attemptid,this.ready=a.ready,this.remotetranscribe=a.remotetranscribe,this.register_controls(),this.register_events(),!this.ready&&this.remotetranscribe&&this.check_for_results(this,15)},init_strings:function(){var a=this;d.get_string("checking","mod_readaloud").done(function(b){a.checking=b}),d.get_string("secs_till_check","mod_readaloud").done(function(b){a.secstillcheck=b}),d.get_string("notgradedyet","mod_readaloud").done(function(b){a.notgradedyet=b}),d.get_string("evaluatedmessage","mod_readaloud").done(function(b){a.evaluated=b})},register_controls:function(){this.controls.heading=a("."+c.smallreportheading),this.controls.player=a("."+c.smallreportplayer),this.controls.rating=a("."+c.smallreportrating),this.controls.status=a("."+c.smallreportstatus),this.controls.fullreportbutton=a("."+c.fullreportbutton)},register_events:function(){},check_for_results:function(a,c){return c-=1,c>0?(setTimeout(a.check_for_results,1e3,a,c),void a.controls.status.text(a.secstillcheck+c)):(a.controls.status.text(a.checking),void e.call([{methodname:"mod_readaloud_check_for_results",args:{attemptid:a.attemptid},done:function(d){var e=JSON.parse(d);if(e)switch(e.ready){case!0:b.debug("result fetched");for(var f='<i class="fa fa-lg fa-star-o"></i>',g='<i class="fa fa-lg fa-star"></i>',h="",i=0;i<5;i++)h+=e.rating>i?g:f;a.controls.heading.text(a.evaluated),a.controls.rating.html(h),a.controls.status.hide(),a.controls.fullreportbutton.show();break;case!1:default:b.debug("result not fetched"),setTimeout(a.check_for_results,1e3,a,15),a.controls.status.text(a.secstillcheck+c)}},fail:f.exception}]))}}});