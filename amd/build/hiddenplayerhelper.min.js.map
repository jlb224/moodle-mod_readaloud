{"version":3,"file":"hiddenplayerhelper.min.js","sources":["../src/hiddenplayerhelper.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_readaloud/definitions'], function ($, log, def) {\r\n    \"use strict\"; // jshint ;_;\r\n\r\n    log.debug('Readaloud hidden player helper: initialising');\r\n\r\n    return {\r\n\r\n        controls: {},\r\n        hiddenplayer: def.hiddenplayer,\r\n        hiddenplayerbutton: def.hiddenplayerbutton,\r\n        hiddenplayerbuttonactive: def.hiddenplayerbuttonactive,\r\n        hiddenplayerbuttonpaused: def.hiddenplayerbuttonpaused,\r\n        hiddenplayerbuttonplaying: def.hiddenplayerbuttonpaused,\r\n\r\n        init: function (opts) {\r\n            this.register_controls();\r\n            this.register_events();\r\n        },\r\n\r\n        register_controls: function () {\r\n            this.controls.hiddenplayer = $('.' + this.hiddenplayer);\r\n            //we stopped using this because of a race condition where buttons arrived on page after this was called\r\n            //this.controls.hiddenplayerbutton = $('.' + this.hiddenplayerbutton);\r\n        },\r\n\r\n        register_events: function () {\r\n            var that = this;\r\n            var audioplayer = this.controls.hiddenplayer;\r\n\r\n            // Use event delegation to handle the button click\r\n            $(document).on('click', '.' + this.hiddenplayerbutton, function (e) {\r\n                var audiosrc = $(this).attr('data-audiosource');\r\n                if (audiosrc === audioplayer.attr('src') && !(audioplayer.prop('paused'))) {\r\n                    that.dohiddenstop();\r\n                } else {\r\n                    that.dohiddenplay(audiosrc);\r\n                }\r\n            });\r\n        },\r\n\r\n        dohiddenplay: function (audiosrc) {\r\n            var m = this;\r\n            var audioplayer = m.controls.hiddenplayer;\r\n            audioplayer.attr('src', audiosrc);\r\n            audioplayer[0].pause();\r\n            audioplayer[0].load();\r\n            var pp = audioplayer[0].play();\r\n            if (pp !== undefined) {\r\n                pp.then(function () {\r\n                    // Yay we are playing\r\n                }).catch(function (error) {\r\n                    // somethings up ... but we can ignore it\r\n                });\r\n            }\r\n            m.dobuttonicons();\r\n        },\r\n        dohiddenstop: function () {\r\n            var m = this;\r\n            var audioplayer = m.controls.hiddenplayer;\r\n            audioplayer[0].pause();\r\n            m.dobuttonicons();\r\n        },\r\n\r\n        dobuttonicons: function (theaudiosrc) {\r\n            var m = this;\r\n            var audioplayer = m.controls.hiddenplayer;\r\n            var thebuttons = $('.' + this.hiddenplayerbutton);\r\n            if (!theaudiosrc) {\r\n                theaudiosrc = audioplayer.attr('src');\r\n            }\r\n            thebuttons.each(function (index) {\r\n                var audiosrc = $(this).attr('data-audiosource');\r\n                if (audiosrc === theaudiosrc) {\r\n                    $(this).addClass(m.hiddenplayerbuttonactive);\r\n                    if ($(audioplayer).prop('paused')) {\r\n                        $(this).removeClass(m.hiddenplayerbuttonplaying);\r\n                        $(this).addClass(m.hiddenplayerbuttonpaused);\r\n                        //for now we make it look like no button is selected\r\n                        //later we can implement better controls\r\n                        $(this).removeClass(m.hiddenplayerbuttonactive);\r\n                    } else {\r\n                        $(this).removeClass(m.hiddenplayerbuttonpaused);\r\n                        $(this).addClass(m.hiddenplayerbuttonplaying);\r\n                    }\r\n                } else {\r\n                    $(this).removeClass(m.hiddenplayerbuttonactive);\r\n                    $(this).removeClass(m.hiddenplayerbuttonplaying);\r\n                    $(this).removeClass(m.hiddenplayerbuttonpaused);\r\n                }\r\n            });\r\n        }\r\n    };//end of return object\r\n\r\n});"],"names":["define","$","log","def","debug","controls","hiddenplayer","hiddenplayerbutton","hiddenplayerbuttonactive","hiddenplayerbuttonpaused","hiddenplayerbuttonplaying","init","opts","register_controls","register_events","this","that","audioplayer","document","on","e","audiosrc","attr","prop","dohiddenplay","dohiddenstop","pause","load","pp","play","undefined","then","catch","error","dobuttonicons","theaudiosrc","m","thebuttons","each","index","addClass","removeClass"],"mappings":"AAAAA,0CAAO,CAAC,SAAU,WAAY,8BAA8B,SAAUC,EAAGC,IAAKC,YAG1ED,IAAIE,MAAM,gDAEH,CAEHC,SAAU,GACVC,aAAcH,IAAIG,aAClBC,mBAAoBJ,IAAII,mBACxBC,yBAA0BL,IAAIK,yBAC9BC,yBAA0BN,IAAIM,yBAC9BC,0BAA2BP,IAAIM,yBAE/BE,KAAM,SAAUC,WACPC,yBACAC,mBAGTD,kBAAmB,gBACVR,SAASC,aAAeL,EAAE,IAAMc,KAAKT,eAK9CQ,gBAAiB,eACTE,KAAOD,KACPE,YAAcF,KAAKV,SAASC,aAGhCL,EAAEiB,UAAUC,GAAG,QAAS,IAAMJ,KAAKR,oBAAoB,SAAUa,OACzDC,SAAWpB,EAAEc,MAAMO,KAAK,oBACxBD,WAAaJ,YAAYK,KAAK,QAAYL,YAAYM,KAAK,UAG3DP,KAAKQ,aAAaH,UAFlBL,KAAKS,mBAOjBD,aAAc,SAAUH,cAEhBJ,YADIF,KACYV,SAASC,aAC7BW,YAAYK,KAAK,MAAOD,UACxBJ,YAAY,GAAGS,QACfT,YAAY,GAAGU,WACXC,GAAKX,YAAY,GAAGY,YACbC,IAAPF,IACAA,GAAGG,MAAK,eAELC,OAAM,SAAUC,WATflB,KAaNmB,iBAENT,aAAc,WACFV,KACYV,SAASC,aACjB,GAAGoB,QAFPX,KAGNmB,iBAGNA,cAAe,SAAUC,iBACjBC,EAAIrB,KACJE,YAAcmB,EAAE/B,SAASC,aACzB+B,WAAapC,EAAE,IAAMc,KAAKR,oBACzB4B,cACDA,YAAclB,YAAYK,KAAK,QAEnCe,WAAWC,MAAK,SAAUC,OACPtC,EAAEc,MAAMO,KAAK,sBACXa,aACblC,EAAEc,MAAMyB,SAASJ,EAAE5B,0BACfP,EAAEgB,aAAaM,KAAK,WACpBtB,EAAEc,MAAM0B,YAAYL,EAAE1B,2BACtBT,EAAEc,MAAMyB,SAASJ,EAAE3B,0BAGnBR,EAAEc,MAAM0B,YAAYL,EAAE5B,4BAEtBP,EAAEc,MAAM0B,YAAYL,EAAE3B,0BACtBR,EAAEc,MAAMyB,SAASJ,EAAE1B,8BAGvBT,EAAEc,MAAM0B,YAAYL,EAAE5B,0BACtBP,EAAEc,MAAM0B,YAAYL,EAAE1B,2BACtBT,EAAEc,MAAM0B,YAAYL,EAAE3B"}