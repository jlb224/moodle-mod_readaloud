define(["jquery","core/log","mod_readaloud/definitions"],function(a,b,c){"use strict";return b.debug("Model Audio helper: initialising"),{controls:{},breaks:[],endwordnumber:0,currentstartbreak:!1,cd:{audioplayerclass:c.audioplayerclass,wordplayerclass:c.wordplayerclass,wordclass:c.wordclass,spaceclass:c.spaceclass,endspaceclass:c.endspaceclass,passagecontainer:c.passagecontainer,activesentence:c.activesentence},init:function(a){a.breaks&&(this.breaks=JSON.parse(a.breaks)),a.audioplayerclass&&(this.cd.audioplayerclass=a.audioplayerclass),this.register_controls(),this.endwordnumber=this.controls.eachword.length,this.register_events()},set_breaks:function(a){this.breaks=a,this.sort_breaks()},sort_breaks:function(){this.breaks.sort(function(a,b){return a.audiotime-b.audiotime})},register_controls:function(){this.controls.audioplayer=a("#"+this.cd.audioplayerclass),this.controls.eachword=a("."+this.cd.wordclass),this.controls.eachspace=a("."+this.cd.spaceclass),this.controls.passagecontainer=a("."+this.cd.passagecontainer)},register_events:function(){var b=this,c=this.controls.audioplayer[0],d=function(){b.controls.eachword.removeClass(b.cd.activesentence),b.controls.eachspace.removeClass(b.cd.activesentence),b.currentstartbreak=!1};c.onended=d,c.onpause=d,c.ontimeupdate=function(){for(var d=c.currentTime,e=!1,f=!1,g=0;g<b.breaks.length;g++)if(d>=b.breaks[g].audiotime&&g+1===b.breaks.length)e=b.breaks[g],f={wordnumber:b.endwordnumber+1,audiotime:0};else{if(d>=b.breaks[g].audiotime&&d<b.breaks[g+1].audiotime){e=b.breaks[g],f=b.breaks[g+1];break}0===g&&d<b.breaks[g].audiotime&&d>0&&(e={wordnumber:0,audiotime:0},f=b.breaks[g])}if(b.currentstartbreak==e);else if(b.currentstartbreak=e,b.controls.eachword.removeClass(b.cd.activesentence),b.controls.eachspace.removeClass(b.cd.activesentence),e!==!1&&f!==!1)for(var h=e.wordnumber+1;h<=f.wordnumber;h++)a("#"+b.cd.spaceclass+"_"+h).addClass(b.cd.activesentence),a("#"+b.cd.wordclass+"_"+h).addClass(b.cd.activesentence)}}}});