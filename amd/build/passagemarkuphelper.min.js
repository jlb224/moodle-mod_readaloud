define(["jquery","core/log","mod_readaloud/definitions"],(function($,log,def){return log.debug("Click to hear: initialising"),{controls:{},passage:null,allwords:null,allspaces:null,cd:{wordclass:def.wordclass,spaceclass:def.spaceclass,badwordclass:def.badwordclass,endspaceclass:def.endspaceclass,unreadwordclass:def.unreadwordclass,unreadspaceclass:def.unreadspaceclass,aiunmatched:def.aiunmatched,passagecontainer:def.passagecontainer,fullreportcontainer:def.fullreportcontainer},init:function(passage){this.passage=passage,this.allwords=this.passage.find("."+this.cd.wordclass),this.allspaces=this.passage.find("."+this.cd.spaceclass)},clear_markup:function(){this.allspaces.removeClass(this.cd.endspaceclass),this.allspaces.removeClass(this.cd.unreadspaceclass),this.allwords.removeClass(this.cd.aiunmatched),this.allwords.removeClass(this.cd.unreadwordclass),this.allwords.removeClass(this.cd.badwordclass)},get_word:function(wordnumber){return this.passage.find("."+this.cd.wordclass+"[data-wordnumber="+wordnumber+"]")},get_space:function(wordnumber){return this.passage.find("."+this.cd.spaceclass+"[data-wordnumber="+wordnumber+"]")},markup_passage:function(sessionmatches,sessionerrors,sessionendword){this.markup_badwords(sessionerrors),this.markup_endword(sessionendword),this.mark_unreadwords(sessionendword)},markup_badwords:function(errorwords){log.debug("doing bad words");var that=this;$.each(errorwords,(function(index){log.debug(" bad word: index: "+index+" wordnumber: "+errorwords[index].wordnumber),that.get_word(errorwords[index].wordnumber).addClass(that.cd.badwordclass)}))},markup_endword:function(endwordnumber){this.get_space(endwordnumber).addClass(this.cd.endspaceclass)},markup_aiunmatchedwords:function(sessionmatches,endwordnumber){var that=this;if(sessionmatches){var prevmatch=0;$.each(sessionmatches,(function(index,match){var unmatchedcount=index-prevmatch-1;if(unmatchedcount>0)for(var errorword=1;errorword<unmatchedcount+1;errorword++){var wordnumber=prevmatch+errorword;that.get_word(wordnumber).addClass(that.cd.aiunmatched)}prevmatch=parseInt(index)}));for(var errorwordnumber=prevmatch+1;errorwordnumber<=endwordnumber;errorwordnumber++)that.get_word(errorwordnumber).addClass(that.cd.aiunmatched)}},markup_aiunmatchedspaces:function(){var that=this;$("."+this.cd.wordclass+"."+this.cd.aiunmatched).each((function(index){var wordnumber=parseInt($(this).attr("data-wordnumber"));that.get_word(wordnumber+1).hasClass(that.cd.aiunmatched)&&that.get_word(wordnumber).addClass(that.cd.aiunmatched)}))},mark_unreadwords:function(endwordnumber){var that=this;that.allwords.each((function(index){var wordnumber=$(this).attr("data-wordnumber"),thespace=that.get_space(wordnumber);Number(wordnumber)>Number(endwordnumber)?($(this).addClass(that.cd.unreadwordclass),thespace.addClass(that.cd.unreadspaceclass),$(this).removeClass(that.cd.badwordclass)):($(this).removeClass(that.cd.unreadwordclass),thespace.removeClass(that.cd.unreadspaceclass))}))}}}));

//# sourceMappingURL=passagemarkuphelper.min.js.map