{"version":3,"file":"mediaprompts.min.js","sources":["../src/mediaprompts.js"],"sourcesContent":["define(['jquery','core/log','core/notification','core/str'], function($,log,notification,str) {\r\n    \"use strict\"; // jshint ;_;\r\n\r\n/*\r\nThis file contains functions for media prompts on the mform\r\n */\r\n\r\n    log.debug('ReadAloud mediaprompts: initialising');\r\n\r\n    return{\r\n\r\n        controls:{},\r\n        strings: {},\r\n\r\n        //init the media prompts\r\n        init: function(opts){\r\n            var that = this;\r\n            this.init_strings();\r\n            this.init_controls();\r\n            this.register_events();\r\n\r\n            //init the visibility of the fieldsets\r\n            $.each(opts, function(key, value){\r\n                log.debug('key: '+key+' value: '+value);\r\n                if(value===1){\r\n                    var thefieldset=$('#ra_mediaprompt_panel_'+key);\r\n                    thefieldset.show();\r\n                    //disable the option in the dropdown\r\n                    that.controls.select.find('option[value=\"' + key + '\"]').prop('disabled', true);\r\n                }\r\n            });\r\n\r\n            //unselect the media prompts thingy\r\n            that.controls.select.find('option[value=\"0\"]').prop('disabled', true);\r\n            that.controls.select.prop('selectedIndex',0);\r\n        },\r\n\r\n         // Set up strings\r\n        init_strings: function(){\r\n            var that = this;  \r\n            str.get_strings([\r\n                { \"key\": \"reallydeletemediaprompt\", \"component\": 'mod_readaloud' },\r\n                { \"key\": \"deletemediaprompt\", \"component\": 'mod_readaloud' },\r\n                { \"key\": \"delete\", \"component\": 'core' },\r\n                { \"key\": \"deletefilesfirst\", \"component\": 'mod_readaloud' },\r\n                { \"key\": \"cleartextfirst\", \"component\": 'mod_readaloud' },\r\n            ]).done(function (s) {\r\n                var i = 0;\r\n                that.strings.reallydeletemediaprompt = s[i++];\r\n                that.strings.deletemediaprompt = s[i++];\r\n                that.strings.delete = s[i++];\r\n                that.strings.deletefilesfirst = s[i++];\r\n                that.strings.cleartextfirst = s[i++];\r\n            });\r\n        },\r\n\r\n        //get handles on all the page elements we will refer to\r\n        init_controls: function(){\r\n            //the media prompt select dropdown\r\n            this.controls.select = $('#id_mediaprompts');\r\n            this.controls.selectcontainer = $('#fitem_id_mediaprompts');\r\n        },\r\n\r\n        //register events on select and fieldsets etc\r\n        register_events: function(){\r\n            var that=this;\r\n            log.debug(\"register events\");\r\n            //on select change add the fieldset\r\n            this.controls.select.on('change',function(){\r\n                log.debug(\"changed\");\r\n                var mediaprompt = $(this).val();\r\n                var thefieldset = $('#ra_mediaprompt_panel_' + mediaprompt);\r\n              //tinymce breaks if we move it arround the DOM .. so we dont insertAfter for textarea\r\n                if(mediaprompt !== 'addtextarea') {\r\n                    thefieldset.insertAfter(that.controls.selectcontainer);\r\n                }\r\n                thefieldset.fadeIn(500); //thefieldset.show();\r\n              \r\n                //disable the option in the dropdown\r\n                that.controls.select.find('option[value=\"' + mediaprompt + '\"]').prop('disabled', true);\r\n                //deselect all options\r\n                that.controls.select.prop('selectedIndex',0);\r\n            });\r\n\r\n            //close the fieldset on button click\r\n            var fieldset_close = $('.ra_mediaprompt_panel button.close');\r\n            fieldset_close.on('click',function(){\r\n                var thefieldset = $(this).closest('fieldset');\r\n                var keyfieldname = thefieldset.data('keyfield');\r\n                var mediaprompt = thefieldset.data('mediaprompt');\r\n                //fetch the input of name keyfield nested under thefieldset\r\n                switch (keyfieldname) {\r\n                    case 'itemttsdialog':\r\n                    case 'itemttspassage':\r\n                    case 'itemtts':\r\n                        var keyfield = thefieldset.find(\"textarea[name='\"+keyfieldname +\"']\");\r\n                        break;\r\n                    default:\r\n                        var keyfield = thefieldset.find(\"input[name='\"+keyfieldname +\"']\");\r\n                }\r\n                \r\n                //fetch the legend text\r\n                var legend = thefieldset.find(\"legend:first\").text();\r\n\r\n                //function to delete the fieldset .. we may seek confirmation first, or not, depending on if the keyfield has data\r\n                var dodelete=function(){\r\n                    //clear the data\r\n                    if(keyfield){\r\n                        keyfield.val('');\r\n                    }\r\n                    //hide the fieldset\r\n                    thefieldset.hide();\r\n                    //re-enable the select option\r\n                    var mediaprompt = thefieldset.data('mediaprompt');\r\n                    that.controls.select.find('option[value=\"' + mediaprompt + '\"]').prop('disabled', false);\r\n                }\r\n                \r\n                switch(keyfieldname){\r\n                    case 'itemmedia':\r\n                        //item media is inaccessible, and hard to clear data so we confirm with a specific message\r\n                        notification.confirm(that.strings.deletemediaprompt, \r\n                                that.strings.deletefilesfirst + ' '+ that.strings.reallydeletemediaprompt + legend + '?',\r\n                                that.strings.delete,'',\r\n                                dodelete);\r\n                        break;\r\n                    case 'itemtextarea':\r\n                        //item text area is hard to check, and hard to clear data so we confirm with a specific message\r\n                        notification.confirm(that.strings.deletemediaprompt, \r\n                            that.strings.cleartextfirst + ' '+  that.strings.reallydeletemediaprompt + legend + '?',\r\n                            that.strings.delete,'',\r\n                            dodelete);\r\n                        break;    \r\n                    default:\r\n                        //if we have data confirm deletion, then delete\r\n                        if(keyfield.length>0 && keyfield.val()!=''){\r\n                            notification.confirm(that.strings.deletemediaprompt, that.strings.reallydeletemediaprompt + legend + '?',\r\n                                that.strings.delete,'',dodelete);\r\n                        }else{\r\n                            dodelete();\r\n                        }\r\n                }\r\n                \r\n            });\r\n        }\r\n\r\n    };//end of return value\r\n});"],"names":["define","$","log","notification","str","debug","controls","strings","init","opts","that","this","init_strings","init_controls","register_events","each","key","value","show","select","find","prop","get_strings","done","s","i","reallydeletemediaprompt","deletemediaprompt","delete","deletefilesfirst","cleartextfirst","selectcontainer","on","mediaprompt","val","thefieldset","insertAfter","fadeIn","closest","keyfieldname","data","keyfield","legend","text","dodelete","hide","confirm","length"],"mappings":"AAAAA,oCAAO,CAAC,SAAS,WAAW,oBAAoB,aAAa,SAASC,EAAEC,IAAIC,aAAaC,YAOrFF,IAAIG,MAAM,wCAEJ,CAEFC,SAAS,GACTC,QAAS,GAGTC,KAAM,SAASC,UACPC,KAAOC,UACNC,oBACAC,qBACAC,kBAGLb,EAAEc,KAAKN,MAAM,SAASO,IAAKC,QACvBf,IAAIG,MAAM,QAAQW,IAAI,WAAWC,OACtB,IAARA,SACiBhB,EAAE,yBAAyBe,KAC/BE,OAEZR,KAAKJ,SAASa,OAAOC,KAAK,iBAAmBJ,IAAM,MAAMK,KAAK,YAAY,OAKlFX,KAAKJ,SAASa,OAAOC,KAAK,qBAAqBC,KAAK,YAAY,GAChEX,KAAKJ,SAASa,OAAOE,KAAK,gBAAgB,IAI9CT,aAAc,eACNF,KAAOC,KACXP,IAAIkB,YAAY,CACZ,KAAS,oCAAwC,iBACjD,KAAS,8BAAkC,iBAC3C,KAAS,mBAAuB,QAChC,KAAS,6BAAiC,iBAC1C,KAAS,2BAA+B,mBACzCC,MAAK,SAAUC,OACVC,EAAI,EACRf,KAAKH,QAAQmB,wBAA0BF,EAAEC,KACzCf,KAAKH,QAAQoB,kBAAoBH,EAAEC,KACnCf,KAAKH,QAAQqB,OAASJ,EAAEC,KACxBf,KAAKH,QAAQsB,iBAAmBL,EAAEC,KAClCf,KAAKH,QAAQuB,eAAiBN,EAAEC,SAKxCZ,cAAe,gBAENP,SAASa,OAASlB,EAAE,yBACpBK,SAASyB,gBAAkB9B,EAAE,2BAItCa,gBAAiB,eACTJ,KAAKC,KACTT,IAAIG,MAAM,wBAELC,SAASa,OAAOa,GAAG,UAAS,WAC7B9B,IAAIG,MAAM,eACN4B,YAAchC,EAAEU,MAAMuB,MACtBC,YAAclC,EAAE,yBAA2BgC,aAE5B,gBAAhBA,aACCE,YAAYC,YAAY1B,KAAKJ,SAASyB,iBAE1CI,YAAYE,OAAO,KAGnB3B,KAAKJ,SAASa,OAAOC,KAAK,iBAAmBa,YAAc,MAAMZ,KAAK,YAAY,GAElFX,KAAKJ,SAASa,OAAOE,KAAK,gBAAgB,MAIzBpB,EAAE,sCACR+B,GAAG,SAAQ,eAClBG,YAAclC,EAAEU,MAAM2B,QAAQ,YAC9BC,aAAeJ,YAAYK,KAAK,YAClBL,YAAYK,KAAK,sBAE3BD,kBACC,oBACA,qBACA,cACGE,SAAWN,YAAYf,KAAK,kBAAkBmB,aAAc,oBAG5DE,SAAWN,YAAYf,KAAK,eAAemB,aAAc,UAIjEG,OAASP,YAAYf,KAAK,gBAAgBuB,OAG1CC,SAAS,WAENH,UACCA,SAASP,IAAI,IAGjBC,YAAYU,WAERZ,YAAcE,YAAYK,KAAK,eACnC9B,KAAKJ,SAASa,OAAOC,KAAK,iBAAmBa,YAAc,MAAMZ,KAAK,YAAY,WAG/EkB,kBACE,YAEDpC,aAAa2C,QAAQpC,KAAKH,QAAQoB,kBAC1BjB,KAAKH,QAAQsB,iBAAmB,IAAKnB,KAAKH,QAAQmB,wBAA0BgB,OAAS,IACrFhC,KAAKH,QAAQqB,OAAO,GACpBgB,oBAEP,eAEDzC,aAAa2C,QAAQpC,KAAKH,QAAQoB,kBAC9BjB,KAAKH,QAAQuB,eAAiB,IAAMpB,KAAKH,QAAQmB,wBAA0BgB,OAAS,IACpFhC,KAAKH,QAAQqB,OAAO,GACpBgB,wBAIDH,SAASM,OAAO,GAAqB,IAAhBN,SAASP,MAC7B/B,aAAa2C,QAAQpC,KAAKH,QAAQoB,kBAAmBjB,KAAKH,QAAQmB,wBAA0BgB,OAAS,IACjGhC,KAAKH,QAAQqB,OAAO,GAAGgB,UAE3BA"}