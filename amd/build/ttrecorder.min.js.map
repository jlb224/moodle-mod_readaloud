{"version":3,"file":"ttrecorder.min.js","sources":["../src/ttrecorder.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_readaloud/ttaudiohelper', 'core/notification',\r\n    'mod_readaloud/ttbrowserrec','core/str','mod_readaloud/timer' ],\r\n    function ($, log, audioHelper, notification, browserRec, str, timer) {\r\n        \"use strict\"; // jshint ;_;\r\n        /*\r\n        *  The TT recorder\r\n         */\r\n\r\n        log.debug('TT Recorder: initialising');\r\n\r\n        return {\r\n            waveHeight: 75,\r\n            audio: {\r\n                stream: null,\r\n                blob: null,\r\n                dataURI: null,\r\n                start: null,\r\n                end: null,\r\n                isRecording: false,\r\n                isRecognizing: false,\r\n                transcript: null\r\n            },\r\n            submitting: false,\r\n            owner: '',\r\n            controls: {},\r\n            uniqueid: null,\r\n            audio_updated: null,\r\n            maxTime: 15000,\r\n            passagehash: null,\r\n            region: null,\r\n            asrurl: null,\r\n            lang: null,\r\n            browserrec: null,\r\n            usebrowserrec: false,\r\n            currentTime: 0,\r\n            stt_guided: false,\r\n            currentPrompt: false,\r\n            strings: {},\r\n\r\n            //for making multiple instances\r\n            clone: function () {\r\n                return $.extend(true, {}, this);\r\n            },\r\n\r\n            init: function(opts){\r\n\r\n                var that = this;\r\n                this.uniqueid=opts['uniqueid'];\r\n                this.callback=opts['callback'];\r\n                this.stt_guided = opts['stt_guided'] ? opts['stt_guided'] : false;\r\n                this.shadow = opts['shadow'];\r\n                this.init_strings();\r\n                this.prepare_html();\r\n                this.controls.recordercontainer.show();\r\n                this.register_events();\r\n\r\n                //set up events\r\n                var on_gotstream=  function(stream) {\r\n                    var newaudio={stream: stream, isRecording: true};\r\n                    that.update_audio(newaudio);\r\n\r\n                };\r\n\r\n                  // Callback: Timer updates.\r\n            var handle_timer_update = function(){\r\n                var displaytime = that.timer.fetch_display_time();\r\n                that.controls.timerstatus.html(displaytime);\r\n                log.debug('timer_seconds: ' + that.timer.seconds);\r\n                log.debug('displaytime: ' + displaytime);\r\n                if (that.timer.seconds == 0 && that.timer.initseconds > 0) {\r\n                    that.update_audio('isRecognizing', true);\r\n                    if(that.usebrowserrec){\r\n                        that.browserrec.stop();\r\n                    }else{\r\n                        that.audiohelper.stop();\r\n                    }\r\n                }\r\n            };\r\n\r\n            // Callback: Recorder device errors.\r\n                var on_error = function(error) {\r\n                    switch (error.name) {\r\n                        case 'PermissionDeniedError':\r\n                        case 'NotAllowedError':\r\n                        notification.alert(\"Error\",that.strings.allowmicaccess, \"OK\");\r\n                            break;\r\n                        case 'DevicesNotFoundError':\r\n                        case 'NotFoundError':\r\n                        notification.alert(\"Error\",that.strings.nomicdetected, \"OK\");\r\n                            break;\r\n                        default:\r\n                            //other errors, like from Edge can fire repeatedly so a notification is not a good idea\r\n                            //notification.alert(\"Error\", error.name, \"OK\");\r\n                            log.debug(\"Error\", error.name);\r\n                    }\r\n                };\r\n\r\n            // Callback: Recording stopped.\r\n                var on_stopped = function(blob) {\r\n                    that.timer.stop()\r\n\r\n                    //if the blob is undefined then the user is super clicking or something\r\n                    if(blob===undefined){\r\n                        return;\r\n                    }\r\n\r\n                    //if ds recc\r\n                    var newaudio = {\r\n                        blob: blob,\r\n                        dataURI: URL.createObjectURL(blob),\r\n                        end: new Date(),\r\n                        isRecording: false,\r\n                        length: Math.round((that.audio.end - that.audio.start) / 1000),\r\n                    };\r\n                    that.update_audio(newaudio);\r\n\r\n                    that.deepSpeech2(that.audio.blob, function(response){\r\n                        log.debug(response);\r\n                        if(response.data.result===\"success\" && response.data.transcript){\r\n                            that.gotRecognition(response.data.transcript.trim());\r\n                        } else {\r\n                        notification.alert(\"Information\",that.strings.speechnotrecognized, \"OK\");\r\n                        }\r\n                        that.update_audio('isRecognizing',false);\r\n                    });\r\n\r\n                };\r\n\r\n                //If browser rec (Chrome Speech Rec) (and ds is optiona)\r\n                if(browserRec.will_work_ok() && ! this.stt_guided){\r\n                    //Init browserrec\r\n                    log.debug(\"using browser rec\");\r\n                    this.browserrec = browserRec.clone();\r\n                    this.browserrec.init(this.lang,this.waveHeight,this.uniqueid);\r\n                    this.usebrowserrec=true;\r\n\r\n                    //set up events\r\n                    that.browserrec.onerror = on_error;\r\n                    that.browserrec.onend = function(){\r\n                        //do something here\r\n                    };\r\n                    that.browserrec.onstart = function(){\r\n                        //do something here\r\n                    };\r\n                    that.browserrec.onfinalspeechcapture=function(speechtext){\r\n                        that.gotRecognition(speechtext);\r\n                        that.update_audio('isRecording',false);\r\n                        that.update_audio('isRecognizing',false);\r\n                    };\r\n\r\n                    that.browserrec.oninterimspeechcapture=function(speechtext){\r\n                        that.gotInterimRecognition(speechtext);\r\n                    };\r\n\r\n                    //If DS rec\r\n                }else {\r\n                    //set up wav for ds rec\r\n                    log.debug(\"using ds rec\");\r\n                    this.audiohelper =  audioHelper.clone();\r\n                    this.audiohelper.init(this.waveHeight,this.uniqueid,this);\r\n\r\n                    that.audiohelper.onError = on_error;\r\n                    that.audiohelper.onStop = on_stopped;\r\n                    that.audiohelper.onStream = on_gotstream;\r\n\r\n                }//end of setting up recorders\r\n\r\n            // Setting up timer.\r\n            this.timer = timer.clone();\r\n            this.timer.init(this.maxTime, handle_timer_update);\r\n            // Init the timer readout\r\n            handle_timer_update();\r\n        },\r\n\r\n        init_strings: function(){\r\n            var that=this;\r\n            str.get_strings([\r\n                { \"key\": \"allowmicaccess\", \"component\": 'mod_readaloud'},\r\n                { \"key\": \"nomicdetected\", \"component\": 'mod_readaloud'},\r\n                { \"key\": \"speechnotrecognized\", \"component\": 'mod_readaloud'},\r\n\r\n            ]).done(function (s) {\r\n                var i = 0;\r\n                that.strings.allowmicaccess = s[i++];\r\n                that.strings.nomicdetected = s[i++];\r\n                that.strings.speechnotrecognized = s[i++];\r\n            });\r\n        },\r\n\r\n            prepare_html: function(){\r\n                this.controls.recordercontainer =$('#ttrec_container_' + this.uniqueid);\r\n                this.controls.recorderbutton = $('#ttrec_' + this.uniqueid + '_recorderdiv');\r\n                this.controls.timerstatus = $('.timerstatus_' + this.uniqueid);\r\n                this.passagehash =this.controls.recorderbutton.data('passagehash');\r\n                this.region=this.controls.recorderbutton.data('region');\r\n                this.asrurl=this.controls.recorderbutton.data('asrurl');\r\n                this.lang =this.controls.recorderbutton.data('lang');\r\n                this.maxTime=this.controls.recorderbutton.data('maxtime');\r\n                this.waveHeight=this.controls.recorderbutton.data('waveheight');\r\n            },\r\n\r\n            silence_detected: function(){\r\n                if(this.audio.isRecording){\r\n                    this.toggleRecording();\r\n                }\r\n            },\r\n\r\n            update_audio: function(newprops,val){\r\n                \r\n                if (typeof newprops === 'string') {\r\n                    log.debug('update_audio:' + newprops + ':' + val);\r\n                    if (this.audio[newprops] !== val) {\r\n                        this.audio[newprops] = val;\r\n                        this.audio_updated();\r\n                    }\r\n                }else{\r\n                    for (var theprop in newprops) {\r\n                        this.audio[theprop] = newprops[theprop];\r\n                        log.debug('update_audio:' + theprop + ':' + newprops[theprop]);\r\n                    }\r\n                    this.audio_updated();\r\n                }\r\n            },\r\n\r\n            register_events: function(){\r\n                var that = this;\r\n\r\n                this.controls.recordercontainer.click(function(){\r\n                    that.toggleRecording();\r\n                });\r\n\r\n                this.controls.recordercontainer.keypress(function(){\r\n                    that.toggleRecording();\r\n                });\r\n\r\n                this.audio_updated=function() {\r\n                    //pointer\r\n                    if (that.audio.isRecognizing) {\r\n                        that.show_recorder_pointer('none');\r\n                    } else {\r\n                        that.show_recorder_pointer('auto');\r\n                    }\r\n\r\n                    if(that.audio.isRecognizing || that.audio.isRecording ) {\r\n                        this.controls.recorderbutton.css('background', '#e52');\r\n                    }else{\r\n                        this.controls.recorderbutton.css('background', 'green');\r\n                    }\r\n\r\n                    //div content WHEN?\r\n                    that.controls.recorderbutton.html(that.recordBtnContent());\r\n                };\r\n\r\n            },\r\n\r\n            show_recorder_pointer: function(show){\r\n                if(show) {\r\n                    this.controls.recorderbutton.css('pointer-events', 'none');\r\n                }else{\r\n                    this.controls.recorderbutton.css('pointer-events', 'auto');\r\n                }\r\n\r\n            },\r\n\r\n\r\n            gotRecognition:function(transcript){\r\n                log.debug('transcript:' + transcript);\r\n                var message={};\r\n                message.type='speech';\r\n                message.capturedspeech = transcript;\r\n                //POINT\r\n                this.callback(message);\r\n            },\r\n\r\n            gotInterimRecognition:function(transcript){\r\n                var message={};\r\n                message.type='interimspeech';\r\n                message.capturedspeech = transcript;\r\n            //POINT\r\n                this.callback(message);\r\n            },\r\n\r\n            cleanWord: function(word) {\r\n                return word.replace(/['!\"#$%&\\\\'()\\*+,\\-\\.\\/:;<=>?@\\[\\\\\\]\\^_`{|}~']/g,\"\").toLowerCase();\r\n            },\r\n\r\n            recordBtnContent: function() {\r\n\r\n                if(!this.audio.isRecognizing){\r\n\r\n                    if (this.audio.isRecording) {\r\n                        return '<i class=\"fa fa-stop\">';\r\n                    } else {\r\n                        return '<i class=\"fa fa-microphone\">';\r\n                    }\r\n\r\n                } else {\r\n                    return '<i class=\"fa fa-spinner fa-spin\">';\r\n                }\r\n            },\r\n            toggleRecording: function() {\r\n                var that =this;\r\n\r\n                //If we are recognizing, then we want to discourage super click'ers\r\n                if (this.audio.isRecognizing) {\r\n                      return;\r\n                }\r\n\r\n                //If we are current recording\r\n                if (this.audio.isRecording) {\r\n                    that.timer.stop();\r\n\r\n                    //If using Browser Rec (chrome speech)\r\n                    if(this.usebrowserrec){\r\n                        that.update_audio('isRecording',false);\r\n                        that.update_audio('isRecognizing',true);\r\n                        this.browserrec.stop();\r\n\r\n                        //If using DS rec\r\n                    }else{\r\n                        this.update_audio('isRecognizing',true);\r\n                        this.audiohelper.stop();\r\n                    }\r\n\r\n                    //If we are NOT currently recording\r\n                } else {\r\n                    // Run the timer\r\n                    that.currentTime = 0;\r\n                    that.timer.reset();\r\n                    that.timer.start();\r\n                \r\n\r\n                    //If using Browser Rec (chrome speech)\r\n                    if(this.usebrowserrec){\r\n                        this.update_audio('isRecording',true);\r\n                        this.browserrec.start();\r\n\r\n\r\n                        //If using DS Rec\r\n                    }else {\r\n                        var newaudio = {\r\n                            stream: null,\r\n                            blob: null,\r\n                            dataURI: null,\r\n                            start: new Date(),\r\n                            end: null,\r\n                            isRecording: false,\r\n                            isRecognizing:false,\r\n                            transcript: null\r\n                        };\r\n                        this.update_audio(newaudio);\r\n                        this.audiohelper.start(this.shadow);\r\n                    }\r\n\r\n                    //lets notify the caller we stopped recording\r\n                    log.debug('recording started:');\r\n                    var message={};\r\n                    message.type='recordingstarted';\r\n                    that.callback(message);\r\n                }\r\n            },\r\n\r\n\r\n            deepSpeech2: function(blob, callback) {\r\n                var bodyFormData = new FormData();\r\n                var blobname = this.uniqueid + Math.floor(Math.random() * 100) +  '.wav';\r\n                bodyFormData.append('audioFile', blob, blobname);\r\n                bodyFormData.append('scorer', this.passagehash);\r\n                bodyFormData.append('lang', this.lang);\r\n                bodyFormData.append('wwwroot', M.cfg.wwwroot);\r\n                if(this.stt_guided) {\r\n                    bodyFormData.append('strictmode', 'false');\r\n                }else{\r\n                    bodyFormData.append('strictmode', 'true');\r\n                }\r\n                //prompt is used by whisper and other transcibers down the line\r\n                if(this.currentPrompt!==false){\r\n                    bodyFormData.append('prompt', this.currentPrompt);\r\n                }\r\n\r\n                var oReq = new XMLHttpRequest();\r\n                oReq.open(\"POST\", this.asrurl, true);\r\n                oReq.onUploadProgress= function(progressEvent) {};\r\n                oReq.onload = function(oEvent) {\r\n                    if (oReq.status === 200) {\r\n                        callback(JSON.parse(oReq.response));\r\n                    } else {\r\n                        callback({data: {result: \"error\"}});\r\n                        log.debug(oReq.error);\r\n                    }\r\n                };\r\n                try {\r\n                    oReq.send(bodyFormData);\r\n                }catch(err){\r\n                    callback({data: {result: \"error\"}});\r\n                    log.debug(err);\r\n                }\r\n            },\r\n\r\n        };//end of return value\r\n\r\n    });"],"names":["define","$","log","audioHelper","notification","browserRec","str","timer","debug","waveHeight","audio","stream","blob","dataURI","start","end","isRecording","isRecognizing","transcript","submitting","owner","controls","uniqueid","audio_updated","maxTime","passagehash","region","asrurl","lang","browserrec","usebrowserrec","currentTime","stt_guided","currentPrompt","strings","clone","extend","this","init","opts","that","callback","shadow","init_strings","prepare_html","recordercontainer","show","register_events","handle_timer_update","displaytime","fetch_display_time","timerstatus","html","seconds","initseconds","update_audio","stop","audiohelper","on_error","error","name","alert","allowmicaccess","nomicdetected","will_work_ok","onerror","onend","onstart","onfinalspeechcapture","speechtext","gotRecognition","oninterimspeechcapture","gotInterimRecognition","onError","onStop","undefined","newaudio","URL","createObjectURL","Date","length","Math","round","deepSpeech2","response","data","result","trim","speechnotrecognized","onStream","get_strings","done","s","i","recorderbutton","silence_detected","toggleRecording","newprops","val","theprop","click","keypress","show_recorder_pointer","css","recordBtnContent","message","capturedspeech","cleanWord","word","replace","toLowerCase","reset","bodyFormData","FormData","blobname","floor","random","append","M","cfg","wwwroot","oReq","XMLHttpRequest","open","onUploadProgress","progressEvent","onload","oEvent","status","JSON","parse","send","err"],"mappings":"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"}