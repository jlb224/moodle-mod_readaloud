{"version":3,"file":"activitycontroller.min.js","sources":["../src/activitycontroller.js"],"sourcesContent":["/* jshint ignore:start */\r\ndefine(['jquery', 'core/log', \"core/str\",'mod_readaloud/definitions',\r\n        'mod_readaloud/recorderhelper', 'mod_readaloud/modelaudiokaraoke',\r\n        'core/ajax','core/notification','mod_readaloud/smallreporthelper','mod_readaloud/listenandrepeat'],\r\n    function ($, log, str,def, recorderhelper, modelaudiokaraoke, Ajax, notification, smallreporthelper, landr) {\r\n\r\n    \"use strict\"; // jshint ;_;\r\n\r\n    log.debug('Activity controller: initialising');\r\n\r\n    return {\r\n\r\n        cmid: null,\r\n        activitydata: null,\r\n        holderid: null,\r\n        recorderid: null,\r\n        playerid: null,\r\n        sorryboxid: null,\r\n        controls: null,\r\n        ra_recorder: null,\r\n        rec_time_start: 0,\r\n        enableshadow: false,\r\n        enablepreview: false,\r\n        enablelandr: false,\r\n        letsshadow: false,\r\n        strings: {},\r\n\r\n\r\n        //CSS in this file\r\n        passagefinished: def.passagefinished,\r\n\r\n        //for making multiple instances\r\n        clone: function () {\r\n            return $.extend(true, {}, this);\r\n        },\r\n\r\n        //pass in config, the jquery video/audio object, and a function to be called when conversion has finshed\r\n        init: function (props) {\r\n            var dd = this.clone();\r\n\r\n            //pick up opts from html\r\n            var theid = '#amdopts_' + props.widgetid;\r\n            var configcontrol = $(theid).get(0);\r\n            if (configcontrol) {\r\n                dd.activitydata = JSON.parse(configcontrol.value);\r\n                $(theid).remove();\r\n            } else {\r\n                //if there is no config we might as well give up\r\n                log.debug('Read Aloud Test Controller: No config found on page. Giving up.');\r\n                return;\r\n            }\r\n\r\n            // FIXME: Temp hacky fix.\r\n            if (dd.activitydata.quizcontainer) {\r\n                dd.activitydata.audioplayerclass = \"mod_readaloud_modelaudio_player\";\r\n            }\r\n\r\n            dd.cmid = props.cmid;\r\n            dd.holderid = props.widgetid + '_holder';\r\n            dd.recorderid = props.widgetid + '_recorder';\r\n            dd.playerid = props.widgetid + '_player';\r\n            dd.sorryboxid = props.widgetid + '_sorrybox';\r\n\r\n            //if the browser doesn't support html5 recording.\r\n            //then warn and do not go any further\r\n            if (!dd.is_browser_ok()) {\r\n                $('#' + dd.sorryboxid).show();\r\n                return;\r\n            }\r\n\r\n            //set up model audio\r\n            dd.enableshadow =dd.activitydata.enableshadow;\r\n            dd.enablepreview =dd.activitydata.enablepreview;\r\n            dd.enablelandr =dd.activitydata.enablelandr;\r\n            dd.setupmodelaudio();\r\n\r\n            //set up listen an repeat\r\n            dd.setuplandr();\r\n\r\n            //init recorder and html and events\r\n            dd.setup_recorder();\r\n            dd.process_html(dd.activitydata);\r\n            dd.register_events();\r\n            dd.setup_strings();\r\n\r\n            //set initial mode\r\n            //we used to check the settings but now we just show the non-options greyed out\r\n            if(dd.enableshadow || dd.enablepreview || true){\r\n                dd.domenulayout();\r\n            }else{\r\n                dd.doreadinglayout();\r\n            }\r\n        },\r\n\r\n        setup_strings: function(){\r\n            var dd = this;\r\n            // Set up strings\r\n            str.get_strings([\r\n                { \"key\": \"confirm_cancel_recording\", \"component\": def.component}\r\n                //more strings here\r\n            ]).done(function (s) {\r\n                var i = 0;\r\n                dd.strings.confirm_cancel_recording= s[i++];\r\n                //more strings here\r\n            });\r\n        },\r\n\r\n        setupmodelaudio: function(){\r\n            var karaoke_opts={breaks:this.activitydata.breaks, audioplayerclass:this.activitydata.audioplayerclass };\r\n            modelaudiokaraoke.init(karaoke_opts);\r\n        },\r\n\r\n        setuplandr: function(){\r\n            var landr_opts={modelaudiokaraoke: modelaudiokaraoke, cmid: this.cmid, language: this.activitydata.language,\r\n                region: this.activitydata.region, phonetics: this.activitydata.phonetics, stt_guided: this.activitydata.stt_guided};\r\n            landr.init(landr_opts);\r\n        },\r\n\r\n        process_html: function (opts) {\r\n\r\n            //these css classes/ids are all passed in from php in\r\n            //renderer.php::fetch_activity_amd should maybe just simplify and declare them in definitions.js\r\n            var controls = {\r\n                hider: $('.' + opts['hider']),\r\n                introbox: $('.' + 'mod_intro_box'),\r\n                progresscontainer: $('.' + opts['progresscontainer']),\r\n                feedbackcontainer: $('.' + opts['feedbackcontainer']),\r\n                errorcontainer: $('.' + opts['errorcontainer']),\r\n                passagecontainer: $('.' + opts['passagecontainer']),\r\n                recordingcontainer: $('.' + opts['recordingcontainer']),\r\n                dummyrecorder: $('.' + opts['dummyrecorder']),\r\n                recordercontainer: $('.' + opts['recordercontainer']),\r\n                menubuttonscontainer: $('.' + opts['menubuttonscontainer']),\r\n                menuinstructionscontainer: $('.' + opts['menuinstructionscontainer']),\r\n                previewinstructionscontainer: $('.' + opts['previewinstructionscontainer']),\r\n                landrinstructionscontainer: $('.' + opts['landrinstructionscontainer']),\r\n                activityinstructionscontainer: $('.' + opts['activityinstructionscontainer']),\r\n                recinstructionscontainerright: $('.' + opts['recinstructionscontainerright']),\r\n                recinstructionscontainerleft: $('.' + opts['recinstructionscontainerleft']),\r\n                allowearlyexit: $('.' + opts['allowearlyexit']),\r\n                wheretonextcontainer: $('.' + opts['wheretonextcontainer']),\r\n                modelaudioplayer: $('#' + opts['modelaudioplayer']),\r\n                startlandrbutton: $('#' + opts['startlandrbutton']),\r\n                startpreviewbutton: $('#' + opts['startpreviewbutton']),\r\n                startreadingbutton: $('#' + opts['startreadingbutton']),\r\n                startreportbutton: $('#' + opts['startreportbutton']),\r\n                startshadowbutton: $('#' + opts['startshadowbutton']),\r\n                // startquizbutton: $('#' + opts['startquizbutton']),\r\n                returnmenubutton: $('#' + opts['returnmenubutton']),\r\n                stopandplay: $('#' + opts['stopandplay']),\r\n                smallreportcontainer: $('#' + opts['smallreportcontainer']),\r\n                readingcontainer: $('#' + def.readingcontainer),\r\n                modeimagecontainer: $('#' + opts['modeimagecontainer']),\r\n            };\r\n            this.controls = controls;\r\n        },\r\n\r\n        is_browser_ok: function () {\r\n            return (navigator && navigator.mediaDevices\r\n                && navigator.mediaDevices.getUserMedia);\r\n        },\r\n\r\n        setup_recorder: function () {\r\n            var dd = this;\r\n\r\n            //after the recorder reports that it has (really) started this functuon is called.\r\n            var beginall= function(){\r\n                dd.passagerecorded = true;\r\n                if(dd.enableshadow && dd.letsshadow){\r\n                    dd.controls.modelaudioplayer[0].play();\r\n                }\r\n            };\r\n\r\n            var on_speech = function (eventdata) {\r\n                var speech = eventdata.capturedspeech;\r\n                var speechresults = eventdata.speechresults;\r\n            };\r\n\r\n            //originates from the recording:started event\r\n            //contains no meaningful data\r\n            //See https://api.poodll.com\r\n            var on_recording_start = function (eventdata) {\r\n                dd.rec_time_start = new Date().getTime();\r\n                dd.dopassagelayout();\r\n\r\n               // dd.controls.passagecontainer.show(1000, beginall);\r\n                dd.controls.passagecontainer.show(500,beginall);\r\n                dd.controls.passagecontainer[0].scrollIntoView({behaviour: \"smooth\", block: \"start\", inline: \"nearest\"});\r\n\r\n                /*\r\n                var scrollparent = $(\"#page\");\r\n                var newtop = scrollparent.scrollTop() + dd.controls.passagecontainer.offset().top - scrollparent.offset().top;\r\n                if(newtop<0) {newtop=0;}\r\n                scrollparent.animate({scrollTop: newtop}, 500,beginall);\r\n                */\r\n\r\n            };\r\n\r\n            //originates from the recording:ended event\r\n            //contains no meaningful data\r\n            //See https://api.poodll.com\r\n            var on_recording_end = function (eventdata) {\r\n                //its a bit hacky but the rec end event can arrive immed. somehow probably when the mic test ends\r\n                var now = new Date().getTime();\r\n                if ((now - dd.rec_time_start) < 3000) {\r\n                    return;\r\n                }\r\n                dd.douploadlayout();\r\n                //if we are shadowing we should stop the audio player.\r\n                if(dd.enableshadow && dd.letsshadow){\r\n                    dd.controls.modelaudioplayer[0].currentTime=0;\r\n                    dd.controls.modelaudioplayer[0].pause();\r\n                }\r\n            };\r\n\r\n            //data sent here originates from the awaiting_processing event\r\n            //See https://api.poodll.com\r\n            var on_audio_processing = function (eventdata) {\r\n                //at this point we know the submission has been uploaded and we know the fileURL\r\n                //so we send the submission\r\n                var now = new Date().getTime();\r\n                var rectime = now - dd.rec_time_start;\r\n                if (rectime > 0) {\r\n                    rectime = Math.ceil(rectime / 1000);\r\n                }\r\n\r\n                dd.send_submission(eventdata.mediaurl, rectime);\r\n                //and let the user know that they are all done\r\n                dd.dofinishedlayout();\r\n            };\r\n\r\n            //init the recorder\r\n            recorderhelper.init(dd.activitydata,\r\n                on_recording_start,\r\n                on_recording_end,\r\n                on_audio_processing,\r\n                on_speech);\r\n        },\r\n\r\n        register_events: function () {\r\n            var dd = this;\r\n\r\n            dd.controls.startpreviewbutton.click(function(e){\r\n                dd.dopreviewlayout();\r\n            });\r\n            dd.controls.startpreviewbutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13 ) {\r\n                    dd.dopreviewlayout();\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            dd.controls.startlandrbutton.click(function(e){\r\n                dd.dolandrlayout();\r\n            });\r\n            dd.controls.startlandrbutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13 ) {\r\n                    dd.dolandrlayout();\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            dd.controls.startreadingbutton.click(function(e){\r\n                dd.letsshadow=false;\r\n                dd.doreadinglayout();\r\n            });\r\n            dd.controls.startreadingbutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13) {\r\n                    dd.letsshadow=false;\r\n                    dd.doreadinglayout();\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            dd.controls.startshadowbutton.click(function(e){\r\n                //landr shadowing\r\n                //dd.dolandrlayout();\r\n                // landr.shadow=true;\r\n\r\n                dd.letsshadow=true;\r\n                dd.doreadinglayout();\r\n            });\r\n            dd.controls.startshadowbutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13) {\r\n                    //dd.dolandrlayout();\r\n                    //landr.shadow=true;\r\n\r\n                    dd.letsshadow=true;\r\n                    dd.doreadinglayout();\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            dd.controls.returnmenubutton.click(function(e){\r\n                //in most cases ajax hide show is ok, but L&R stuffs up android for normal readaloud so we reload\r\n                if(dd.isandroid() && dd.controls.landrinstructionscontainer.is(\":visible\")) {\r\n                    location.reload();\r\n                }else if(dd.controls.readingcontainer.is(\":visible\")\r\n                    && dd.controls.passagecontainer.hasClass('readmode')\r\n                    && dd.controls.passagecontainer.is(\":visible\")){\r\n                    // Display a confirmation dialog\r\n                    var result = confirm(dd.strings.confirm_cancel_recording);\r\n                    //there is no way to stop the recorder early, so just reload the page, brutal\r\n                    if (result) {\r\n                        location.reload();\r\n                    }\r\n                }else {\r\n                    dd.controls.modelaudioplayer[0].currentTime = 0;\r\n                    dd.controls.modelaudioplayer[0].pause();\r\n                    dd.domenulayout();\r\n                }\r\n            });\r\n            dd.controls.startreportbutton.click(function(e){\r\n                dd.doreportlayout();\r\n            });\r\n            // dd.controls.startquizbutton.click(function(e){\r\n            //     dd.doquizlayout();\r\n            // });\r\n        },\r\n\r\n        send_submission: function (filename, rectime) {\r\n            var that = this;\r\n            var shadowing = (that.enableshadow && that.letsshadow) ? 1 : 0;\r\n            Ajax.call([{\r\n                methodname: 'mod_readaloud_submit_regular_attempt',\r\n                args: {\r\n                    cmid: that.cmid,\r\n                    filename:  filename,//encodeURIComponent(filename),\r\n                    rectime: rectime,\r\n                    shadowing: shadowing\r\n                },\r\n                done: function(ajaxresult){\r\n                    var payloadobject = JSON.parse(ajaxresult);\r\n                    if (payloadobject) {\r\n                        switch (payloadobject.success) {\r\n                            case true:\r\n                                log.debug('attempted submission accepted');\r\n                                break;\r\n                            case false:\r\n                            default:\r\n                                log.debug('attempted item evaluation failure');\r\n                                if (payloadobject.message) {\r\n                                    log.debug('message: ' + payloadobject.message);\r\n                                }\r\n                        }\r\n                    }\r\n                },\r\n                fail: notification.exception\r\n            }]);\r\n/*\r\n            return;\r\n\r\n            //set up our ajax request\r\n            var xhr = new XMLHttpRequest();\r\n            var that = this;\r\n\r\n            //set up our handler for the response\r\n            xhr.onreadystatechange = function (e) {\r\n                if (this.readyState === 4) {\r\n                    if (xhr.status === 200) {\r\n                        log.debug('ok we got an attempt submission response');\r\n                        //get a yes or forgetit or tryagain\r\n                        var payload = xhr.responseText;\r\n                        var payloadobject = JSON.parse(payload);\r\n                        if (payloadobject) {\r\n                            switch (payloadobject.success) {\r\n                                case true:\r\n                                    log.debug('attempted submission accepted');\r\n\r\n                                    break;\r\n\r\n                                case false:\r\n                                default:\r\n                                    log.debug('attempted item evaluation failure');\r\n                                    if (payloadobject.message) {\r\n                                        log.debug('message: ' + payloadobject.message);\r\n                                    }\r\n                            }\r\n                        }\r\n                    } else {\r\n                        log.debug('Not 200 response:' + xhr.status);\r\n                    }\r\n                }\r\n            };\r\n\r\n            //to get through mod_security environments\r\n            filename = filename.replace(/^https:\\/\\//i, 'https___');\r\n            var params = \"cmid=\" + that.cmid + \"&filename=\" + encodeURIComponent(filename) + \"&rectime=\" + rectime;\r\n            xhr.open(\"POST\", M.cfg.wwwroot + '/mod/readaloud/ajaxhelper.php', true);\r\n            xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n            xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\r\n            xhr.send(params);\r\n*/\r\n        },\r\n\r\n        doreadinglayout: function () {\r\n            var m = this;\r\n            m.controls.hider.fadeOut('fast');\r\n            m.controls.activityinstructionscontainer.show();\r\n            m.controls.recordingcontainer.show();\r\n            m.controls.introbox.hide();\r\n            m.controls.menuinstructionscontainer.hide();\r\n            m.controls.menubuttonscontainer.hide();\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.returnmenubutton.show();\r\n            m.controls.progresscontainer.hide();\r\n            m.controls.passagecontainer.removeClass('previewmode shadowmode reviewmode nothingmode');\r\n            m.controls.passagecontainer.addClass('readmode');\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.feedbackcontainer.hide();\r\n            m.controls.wheretonextcontainer.hide();\r\n            m.controls.stopandplay.hide();\r\n            m.controls.modeimagecontainer.removeClass('preview landr readaloud readaloudshadow report quiz');\r\n            m.controls.modeimagecontainer.addClass('readaloud');\r\n\r\n            modelaudiokaraoke.modeling=true;\r\n        },\r\n\r\n        domenulayout: function () {\r\n            var m = this;\r\n            m.controls.introbox.show();\r\n            m.controls.menuinstructionscontainer.show();\r\n            // m.controls.menubuttonscontainer.show();\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.returnmenubutton.hide();\r\n            m.controls.previewinstructionscontainer.hide();\r\n\r\n            m.controls.landrinstructionscontainer.hide();\r\n            landr.deactivate();\r\n\r\n            m.controls.progresscontainer.hide();\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.feedbackcontainer.hide();\r\n            m.controls.wheretonextcontainer.hide();\r\n            m.controls.modelaudioplayer.hide();\r\n            m.controls.hider.hide();\r\n            m.controls.stopandplay.hide();\r\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\r\n\r\n            modelaudiokaraoke.modeling=true;\r\n        },\r\n\r\n        dopreviewlayout: function () {\r\n            var m = this;\r\n            console.log(\"Before:\", m.controls.modeimagecontainer.attr('class'));\r\n            m.controls.passagecontainer.removeClass('readmode shadowmode reviewmode nothingmode');\r\n            m.controls.passagecontainer.addClass('previewmode');\r\n            m.controls.passagecontainer.show();\r\n            m.controls.previewinstructionscontainer.show();\r\n            m.controls.landrinstructionscontainer.hide();\r\n            m.controls.introbox.hide();\r\n            m.controls.returnmenubutton.show();\r\n            m.controls.modelaudioplayer.hide();\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.stopandplay.show();\r\n            m.controls.menubuttonscontainer.hide();\r\n            m.controls.hider.hide();\r\n            m.controls.progresscontainer.hide();\r\n            m.controls.menuinstructionscontainer.hide();\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.feedbackcontainer.hide();\r\n            m.controls.wheretonextcontainer.hide();\r\n            m.controls.stopandplay.show();\r\n            m.controls.modeimagecontainer.removeClass('landr readaloud readaloudshadow report quiz');\r\n            m.controls.modeimagecontainer.addClass('preview');\r\n            console.log(\"After:\", m.controls.modeimagecontainer.attr('class'));\r\n\r\n            modelaudiokaraoke.modeling=false;\r\n        },\r\n\r\n        dolandrlayout: function () {\r\n            var m = this;\r\n            m.controls.passagecontainer.removeClass('readmode shadowmode reviewmode nothingmode');\r\n            m.controls.passagecontainer.addClass('previewmode');\r\n            m.controls.passagecontainer.show();\r\n            m.controls.landrinstructionscontainer.show();\r\n            m.controls.previewinstructionscontainer.hide();\r\n            m.controls.introbox.hide();\r\n            m.controls.returnmenubutton.show();\r\n            m.controls.modelaudioplayer.hide();\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.stopandplay.show();\r\n            m.controls.menubuttonscontainer.hide();\r\n            m.controls.hider.hide();\r\n            m.controls.progresscontainer.hide();\r\n            m.controls.menuinstructionscontainer.hide();\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.feedbackcontainer.hide();\r\n            m.controls.wheretonextcontainer.hide();\r\n            m.controls.stopandplay.show();\r\n            m.controls.modeimagecontainer.removeClass('preview readaloud readaloudshadow report quiz');\r\n            m.controls.modeimagecontainer.addClass('landr');\r\n            landr.activate();\r\n\r\n            modelaudiokaraoke.modeling=false;\r\n\r\n        },\r\n\r\n        dopassagelayout: function () {\r\n            var m = this;\r\n            m.controls.introbox.hide();\r\n            m.controls.readingcontainer.addClass(def.containerfillscreen);\r\n        },\r\n\r\n        douploadlayout: function () {\r\n            var m = this;\r\n            m.controls.passagecontainer.addClass(m.passagefinished);\r\n            m.controls.hider.fadeIn('fast');\r\n            m.controls.progresscontainer.fadeIn('fast');\r\n        },\r\n\r\n        dofinishedlayout: function () {\r\n            var m = this;\r\n            m.controls.hider.fadeOut('fast');\r\n            m.controls.progresscontainer.fadeOut('fast');\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\r\n            m.controls.feedbackcontainer.show();\r\n            m.controls.wheretonextcontainer.show();\r\n            m.controls.returnmenubutton.hide();\r\n\r\n        },\r\n        doerrorlayout: function () {\r\n            var m = this;\r\n            m.controls.hider.fadeOut('fast');\r\n            m.controls.progresscontainer.fadeOut('fast');\r\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.errorcontainer.show();\r\n            m.controls.wheretonextcontainer.show();\r\n        },\r\n        doreportlayout: function () {\r\n            var m = this;\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.landrinstructionscontainer.hide();\r\n            m.controls.previewinstructionscontainer.hide();\r\n            m.controls.smallreportcontainer.show();\r\n            m.controls.modeimagecontainer.removeClass('preview readaloud readaloudshadow landr quiz');\r\n            m.controls.modeimagecontainer.addClass('report');\r\n        },\r\n        doquizlayout: function () {\r\n            var m = this;\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.modeimagecontainer.removeClass('preview landr readaloud readaloudshadow report');\r\n            m.controls.modeimagecontainer.addClass('quiz');\r\n        },\r\n        isandroid: function() {\r\n                if (/Android/i.test(navigator.userAgent)) {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n        }\r\n    };//end of returned object\r\n});//total end\r\n"],"names":["define","$","log","str","def","recorderhelper","modelaudiokaraoke","Ajax","notification","smallreporthelper","landr","debug","cmid","activitydata","holderid","recorderid","playerid","sorryboxid","controls","ra_recorder","rec_time_start","enableshadow","enablepreview","enablelandr","letsshadow","strings","passagefinished","clone","extend","this","init","props","dd","theid","widgetid","configcontrol","get","JSON","parse","value","remove","quizcontainer","audioplayerclass","is_browser_ok","setupmodelaudio","setuplandr","setup_recorder","process_html","register_events","setup_strings","domenulayout","show","get_strings","component","done","s","i","confirm_cancel_recording","karaoke_opts","breaks","landr_opts","language","region","phonetics","stt_guided","opts","hider","introbox","progresscontainer","feedbackcontainer","errorcontainer","passagecontainer","recordingcontainer","dummyrecorder","recordercontainer","menubuttonscontainer","menuinstructionscontainer","previewinstructionscontainer","landrinstructionscontainer","activityinstructionscontainer","recinstructionscontainerright","recinstructionscontainerleft","allowearlyexit","wheretonextcontainer","modelaudioplayer","startlandrbutton","startpreviewbutton","startreadingbutton","startreportbutton","startshadowbutton","returnmenubutton","stopandplay","smallreportcontainer","readingcontainer","modeimagecontainer","navigator","mediaDevices","getUserMedia","beginall","passagerecorded","play","eventdata","Date","getTime","dopassagelayout","scrollIntoView","behaviour","block","inline","douploadlayout","currentTime","pause","rectime","Math","ceil","send_submission","mediaurl","dofinishedlayout","capturedspeech","speechresults","click","e","dopreviewlayout","keypress","which","preventDefault","dolandrlayout","doreadinglayout","isandroid","is","location","reload","hasClass","confirm","doreportlayout","filename","shadowing","call","methodname","args","ajaxresult","payloadobject","success","message","fail","exception","m","fadeOut","hide","removeClass","addClass","modeling","deactivate","containerfillscreen","console","attr","activate","fadeIn","doerrorlayout","doquizlayout","test","userAgent"],"mappings":"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"}