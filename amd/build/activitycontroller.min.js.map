{"version":3,"file":"activitycontroller.min.js","sources":["../src/activitycontroller.js"],"sourcesContent":["/* jshint ignore:start */\r\ndefine(['jquery', 'core/log', \"core/str\",'mod_readaloud/definitions',\r\n        'mod_readaloud/recorderhelper', 'mod_readaloud/modelaudiokaraoke',\r\n        'core/ajax','core/notification','mod_readaloud/smallreporthelper',\r\n        'mod_readaloud/listenandrepeat','mod_readaloud/quizhelper'],\r\n    function ($, log, str,def, recorderhelper, modelaudiokaraoke,\r\n              Ajax, notification, smallreporthelper, landr, quizhelper) {\r\n\r\n    \"use strict\"; // jshint ;_;\r\n\r\n    log.debug('Activity controller: initialising');\r\n\r\n     // Disable click event.\r\n     function disableClick(e) {\r\n        e.preventDefault();\r\n        e.stopImmediatePropagation();\r\n    }\r\n\r\n    return {\r\n\r\n        cmid: null,\r\n        activitydata: null,\r\n        holderid: null,\r\n        recorderid: null,\r\n        playerid: null,\r\n        sorryboxid: null,\r\n        controls: null,\r\n        ra_recorder: null,\r\n        rec_time_start: 0,\r\n        steps_enabled: {},\r\n        steps_open: {},\r\n        steps_complete: {},\r\n        letsshadow: false,\r\n        strings: {},\r\n\r\n\r\n        //CSS in this file\r\n        passagefinished: def.passagefinished,\r\n\r\n        //for making multiple instances\r\n        clone: function () {\r\n            return $.extend(true, {}, this);\r\n        },\r\n\r\n        //pass in config, the jquery video/audio object, and a function to be called when conversion has finshed\r\n        init: function (props) {\r\n            var dd = this.clone();\r\n\r\n            log.debug('Steps enabled:', props.stepsenabled);\r\n            log.debug('Steps open:', props.stepsopen);\r\n            log.debug('Complete:', props.stepscomplete);\r\n            log.debug('Steps enabled:', props.stepsenabled);\r\n\r\n\r\n            //pick up opts from html\r\n            var theid = '#amdopts_' + props.widgetid;\r\n            var configcontrol = $(theid).get(0);\r\n            if (configcontrol) {\r\n                dd.activitydata = JSON.parse(configcontrol.value);\r\n                $(theid).remove();\r\n            } else {\r\n                //if there is no config we might as well give up\r\n                log.debug('Read Aloud Test Controller: No config found on page. Giving up.');\r\n                return;\r\n            }\r\n\r\n            dd.cmid = props.cmid;\r\n            dd.holderid = props.widgetid + '_holder';\r\n            dd.recorderid = props.widgetid + '_recorder';\r\n            dd.playerid = props.widgetid + '_player';\r\n            dd.sorryboxid = props.widgetid + '_sorrybox';\r\n\r\n            //if the browser doesn't support html5 recording.\r\n            //then warn and do not go any further\r\n            if (!dd.is_browser_ok()) {\r\n                $('#' + dd.sorryboxid).show();\r\n                return;\r\n            }\r\n\r\n            // Set up steps - enabled and open\r\n            //TO DO make these usable in JS (here) and not just in mustache\r\n            dd.steps_enabled = dd.activitydata.stepsenabled; // this is not passed through to JS (only mustache)\r\n            dd.steps_open = dd.activitydata.stepsopen;// this is not passed through to JS (only mustache)\r\n\r\n            // Set up model audio.\r\n            dd.setupmodelaudio();\r\n\r\n            // Set up listen and repeat.\r\n            dd.setuplandr();\r\n\r\n            // Init recorder and html and events.\r\n            dd.setup_recorder();\r\n            dd.process_html(dd.activitydata);\r\n\r\n            dd.register_events();\r\n            dd.setup_strings();\r\n\r\n            // Set up quiz.\r\n            dd.setupquiz();\r\n\r\n            // Set initial mode.\r\n            // We used to check the settings but now we just show the non-options greyed out\r\n            if(dd.stepshadow_enabled || dd.steplisten_enabled || true){\r\n                dd.domenulayout();\r\n            } else {\r\n                dd.doreadinglayout();\r\n            }\r\n        },\r\n\r\n        setup_strings: function(){\r\n            var dd = this;\r\n            // Set up strings\r\n            str.get_strings([\r\n                { \"key\": \"confirm_cancel_recording\", \"component\": def.component}\r\n                //more strings here\r\n            ]).done(function (s) {\r\n                var i = 0;\r\n                dd.strings.confirm_cancel_recording= s[i++];\r\n                //more strings here\r\n            });\r\n        },\r\n\r\n        setupmodelaudio: function(){\r\n            var karaoke_opts={breaks:this.activitydata.breaks, audioplayerclass:this.activitydata.audioplayerclass };\r\n            modelaudiokaraoke.init(karaoke_opts);\r\n        },\r\n\r\n        setuplandr: function(){\r\n            var dd = this;\r\n            var landr_opts={modelaudiokaraoke: modelaudiokaraoke, cmid: this.cmid, language: this.activitydata.language,\r\n                region: this.activitydata.region, phonetics: this.activitydata.phonetics, stt_guided: this.activitydata.stt_guided};\r\n            landr.init(landr_opts);\r\n            //set the callback function to complete the activity\r\n            landr.on_complete = function(){\r\n                // Complete the current step (update server and ui)\r\n                dd.update_activity_step(dd.activitydata.steps.step_practice);\r\n            }\r\n        },\r\n\r\n        setupquiz: function(){\r\n            var dd = this;\r\n            //hack TO DO - get the real attempt id\r\n            dd.attemptid = 1;\r\n\r\n            quizhelper.init(dd.activitydata,\r\n                dd.cmid,\r\n                dd.attemptid);\r\n\r\n            //set the callback function to complete the quiz\r\n            quizhelper.on_complete = function(){\r\n                // Complete the current step (update server and ui)\r\n                dd.update_activity_step(dd.activitydata.steps.step_quiz);\r\n            }\r\n        },\r\n\r\n        process_html: function (opts) {\r\n            //these css classes/ids are all passed in from php in\r\n            //renderer.php::fetch_activity_amd should maybe just simplify and declare them in definitions.js\r\n            var controls = {\r\n                hider: $('.' + opts['hider']),\r\n                introbox: $('.' + 'mod_intro_box'),\r\n                progresscontainer: $('.' + opts['progresscontainer']),\r\n                feedbackcontainer: $('.' + opts['feedbackcontainer']),\r\n                errorcontainer: $('.' + opts['errorcontainer']),\r\n                passagecontainer: $('.' + opts['passagecontainer']),\r\n                recordingcontainer: $('.' + opts['recordingcontainer']),\r\n                dummyrecorder: $('.' + opts['dummyrecorder']),\r\n                recordercontainer: $('.' + opts['recordercontainer']),\r\n                menubuttonscontainer: $('.' + opts['menubuttonscontainer']),\r\n                menuinstructionscontainer: $('.' + opts['menuinstructionscontainer']),\r\n                previewinstructionscontainer: $('.' + opts['previewinstructionscontainer']),\r\n                landrinstructionscontainer: $('.' + opts['landrinstructionscontainer']),\r\n                activityinstructionscontainer: $('.' + opts['activityinstructionscontainer']),\r\n                recinstructionscontainerright: $('.' + opts['recinstructionscontainerright']),\r\n                recinstructionscontainerleft: $('.' + opts['recinstructionscontainerleft']),\r\n                allowearlyexit: $('.' + opts['allowearlyexit']),\r\n                wheretonextcontainer: $('.' + opts['wheretonextcontainer']),\r\n                modelaudioplayer: $('#' + opts['modelaudioplayer']),\r\n                homebutton: $('#' + opts['homebutton']),\r\n                startlistenbutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_listen + '\"]'),\r\n                startpracticebutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_practice + '\"]'),\r\n                startreadbutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_read + '\"]'),\r\n                startshadowbutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_shadow + '\"]'),\r\n                startquizbutton: $('#' + opts['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + opts.steps.step_quiz + '\"]'),\r\n                startreportbutton: $('#' + opts['startreportbutton']),\r\n                returnmenubutton: $('#' + opts['returnmenubutton']),\r\n                stopandplay: $('#' + opts['stopandplay']),\r\n                smallreportcontainer: $('#' + opts['smallreportcontainer']),\r\n                readingcontainer: $('#' + def.readingcontainer),\r\n                modeimagecontainer: $('#' + opts['modeimagecontainer']),\r\n                modejourneycontainer: $('#' + opts['modejourneycontainer']),\r\n                quizcontainer: $('.' +  opts['quizcontainer']),\r\n                quizplaceholder: $('.' +  opts['quizplaceholder']),\r\n                quizresultscontainer: $(\".\" + opts['quizresultscontainer']),\r\n                homecontainer: $('.' +  opts['homecontainer']),\r\n            };\r\n            this.controls = controls;\r\n        },\r\n\r\n        is_browser_ok: function () {\r\n            return (navigator && navigator.mediaDevices\r\n                && navigator.mediaDevices.getUserMedia);\r\n        },\r\n\r\n        setup_recorder: function () {\r\n            var dd = this;\r\n\r\n            //after the recorder reports that it has (really) started this functuon is called.\r\n            var beginall= function(){\r\n                dd.passagerecorded = true;\r\n                if(dd.stepshadow_enabled && dd.letsshadow){\r\n                    dd.controls.modelaudioplayer[0].play();\r\n                }\r\n            };\r\n\r\n            var on_speech = function (eventdata) {\r\n                var speech = eventdata.capturedspeech;\r\n                var speechresults = eventdata.speechresults;\r\n            };\r\n\r\n            //originates from the recording:started event\r\n            //contains no meaningful data\r\n            //See https://api.poodll.com\r\n            var on_recording_start = function (eventdata) {\r\n                dd.rec_time_start = new Date().getTime();\r\n                dd.dopassagelayout();\r\n\r\n               // dd.controls.passagecontainer.show(1000, beginall);\r\n                dd.controls.passagecontainer.show(500,beginall);\r\n                dd.controls.passagecontainer[0].scrollIntoView({behaviour: \"smooth\", block: \"start\", inline: \"nearest\"});\r\n\r\n                /*\r\n                var scrollparent = $(\"#page\");\r\n                var newtop = scrollparent.scrollTop() + dd.controls.passagecontainer.offset().top - scrollparent.offset().top;\r\n                if(newtop<0) {newtop=0;}\r\n                scrollparent.animate({scrollTop: newtop}, 500,beginall);\r\n                */\r\n\r\n            };\r\n\r\n            //originates from the recording:ended event\r\n            //contains no meaningful data\r\n            //See https://api.poodll.com\r\n            var on_recording_end = function (eventdata) {\r\n                //its a bit hacky but the rec end event can arrive immed. somehow probably when the mic test ends\r\n                var now = new Date().getTime();\r\n                if ((now - dd.rec_time_start) < 3000) {\r\n                    return;\r\n                }\r\n                dd.douploadlayout();\r\n                //if we are shadowing we should stop the audio player.\r\n                if(dd.stepshadow_enabled && dd.letsshadow){\r\n                    dd.controls.modelaudioplayer[0].currentTime=0;\r\n                    dd.controls.modelaudioplayer[0].pause();\r\n                }\r\n            };\r\n\r\n            //data sent here originates from the awaiting_processing event\r\n            //See https://api.poodll.com\r\n            var on_audio_processing = function (eventdata) {\r\n                //at this point we know the submission has been uploaded and we know the fileURL\r\n                //so we send the submission\r\n                var now = new Date().getTime();\r\n                var rectime = now - dd.rec_time_start;\r\n                if (rectime > 0) {\r\n                    rectime = Math.ceil(rectime / 1000);\r\n                }\r\n\r\n                dd.send_submission(eventdata.mediaurl, rectime);\r\n\r\n                // Complete the current step (update server and ui)\r\n                dd.update_activity_step(dd.activitydata.steps.step_read);\r\n\r\n                //and let the user know that they are all done\r\n                dd.dofinishedlayout();\r\n            };\r\n\r\n            //init the recorder\r\n            recorderhelper.init(dd.activitydata,\r\n                on_recording_start,\r\n                on_recording_end,\r\n                on_audio_processing,\r\n                on_speech);\r\n        },\r\n\r\n        register_events: function () {\r\n            var dd = this;\r\n\r\n            $('.mode-chooser.no-click').each(function() {\r\n                this.addEventListener('click', disableClick, true);\r\n                this.addEventListener('keypress', disableClick, true);\r\n            });\r\n\r\n            dd.controls.startlistenbutton.click(function(e){\r\n                dd.dopreviewlayout();\r\n                  // TO DO: where to set this properly?\r\n                  // Complete the current step (update server and ui).\r\n                  dd.update_activity_step(dd.activitydata.steps.step_listen);\r\n            });\r\n            dd.controls.startlistenbutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13 ) {\r\n                    dd.dopreviewlayout();\r\n                    e.preventDefault();\r\n                   // TO DO: where to set this properly?\r\n                  // Complete the current step (update server and ui).\r\n                  dd.update_activity_step(dd.activitydata.steps.step_listen);\r\n                }\r\n            });\r\n            dd.controls.startpracticebutton.click(function(e){\r\n                dd.dolandrlayout();\r\n            });\r\n            dd.controls.startpracticebutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13 ) {\r\n                    dd.dolandrlayout();\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            dd.controls.startreadbutton.click(function(e){\r\n                dd.letsshadow=false;\r\n                dd.doreadinglayout();\r\n            });\r\n            dd.controls.startreadbutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13) {\r\n                    dd.letsshadow=false;\r\n                    dd.doreadinglayout();\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            dd.controls.startshadowbutton.click(function(e){\r\n                //landr shadowing\r\n                //dd.dolandrlayout();\r\n                // landr.shadow=true;\r\n\r\n                dd.letsshadow=true;\r\n                dd.doreadinglayout();\r\n            });\r\n            dd.controls.startshadowbutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13) {\r\n                    //dd.dolandrlayout();\r\n                    //landr.shadow=true;\r\n\r\n                    dd.letsshadow=true;\r\n                    dd.doreadinglayout();\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            dd.controls.returnmenubutton.click(function(e){\r\n                //in most cases ajax hide show is ok, but L&R stuffs up android for normal readaloud so we reload\r\n                if(dd.isandroid() && dd.controls.landrinstructionscontainer.is(\":visible\")) {\r\n                    location.reload();\r\n                }else if(dd.controls.readingcontainer.is(\":visible\")\r\n                    && dd.controls.passagecontainer.hasClass('readmode')\r\n                    && dd.controls.passagecontainer.is(\":visible\")){\r\n                    // Display a confirmation dialog\r\n                    var result = confirm(dd.strings.confirm_cancel_recording);\r\n                    //there is no way to stop the recorder early, so just reload the page, brutal\r\n                    if (result) {\r\n                        location.reload();\r\n                    }\r\n                }else {\r\n                    dd.controls.modelaudioplayer[0].currentTime = 0;\r\n                    dd.controls.modelaudioplayer[0].pause();\r\n                    dd.domenulayout();\r\n                }\r\n            });\r\n            dd.controls.startreportbutton.click(function(e){\r\n                dd.doreportlayout();\r\n            });\r\n            dd.controls.startquizbutton.click(function(e){\r\n                dd.doquizlayout();\r\n            });\r\n            dd.controls.startquizbutton.keypress(function(e){\r\n                if (e.which == 32 || e.which == 13 ) {\r\n                    dd.doquizlayout();\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            dd.controls.homebutton.click(function(e){\r\n                dd.domenulayout();\r\n            });\r\n        },\r\n\r\n        // when a step is completed, we update the activity completion on the server\r\n        // and open the next step\r\n        update_activity_step: function (step) {\r\n            var that = this;\r\n            Ajax.call([{\r\n                methodname: 'mod_readaloud_report_activitystep_completion',\r\n                args: {\r\n                    cmid: that.cmid,\r\n                    step:  step\r\n                },\r\n                done: function(ajaxresult){\r\n                    var success = JSON.parse(ajaxresult);\r\n                    switch (success) {\r\n                        case true:\r\n                            var adata = that.activitydata;\r\n                            for (var key in adata.steps) {\r\n                                var thestep = adata.steps[key];\r\n                                if (thestep === step) {\r\n                                    that.activitydata.stepscomplete[key] = true;\r\n                                } else {\r\n                                    continue;\r\n                                }\r\n                            }\r\n                            that.updateModeStatuses();\r\n                            that.updateBigButtonMenuModeStatus();\r\n                            that.open_next_step(step);\r\n\r\n                            break;\r\n                        case false:\r\n                        default:\r\n                            log.debug('step ' + step + ' update failed');\r\n                    }\r\n\r\n                },\r\n                fail: notification.exception\r\n            }]);\r\n        },\r\n\r\n        open_next_step: function(oldstep){\r\n            var that = this;\r\n            var adata = this.activitydata;\r\n            //loop through adata.steps array\r\n            //this looks like['step_listen': 1, 'step_practice': 2, 'step_shadow': 4, 'step_read': 8, 'step_quiz': 16]\r\n            for (var key in adata.steps) {\r\n                var thestep = adata.steps[key];\r\n                //if the looped step is less than or equal to the old step, skip\r\n                if (thestep <= oldstep) {\r\n                    continue;\r\n                } else {\r\n                    //if the looped step is enabled (present on page), open it\r\n                    var step_chooser = $('#' + adata['menubuttonscontainer'] + ' .mode-chooser[data-step=\"' + thestep + '\"]');\r\n                    log.debug(step_chooser);\r\n                    if(step_chooser.length){\r\n                        step_chooser.removeClass('no-click');\r\n                        step_chooser[0].removeEventListener('click', disableClick, true);\r\n\r\n                        // (Hacky) show report if read step was done\r\n                        if (oldstep == adata.steps.step_read) {\r\n                            that.controls.startreportbutton.removeClass('no-click');\r\n                        }\r\n\r\n                        // Record the newly opened step as 'open' for client side use\r\n                        //TO DO-  get this working\r\n                       // that.steps_open[key] = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        send_submission: function (filename, rectime) {\r\n            var that = this;\r\n            var shadowing = (that.stepshadow_enabled && that.letsshadow) ? 1 : 0;\r\n            Ajax.call([{\r\n                methodname: 'mod_readaloud_submit_regular_attempt',\r\n                args: {\r\n                    cmid: that.cmid,\r\n                    filename:  filename,//encodeURIComponent(filename),\r\n                    rectime: rectime,\r\n                    shadowing: shadowing\r\n                },\r\n                done: function(ajaxresult){\r\n                    var payloadobject = JSON.parse(ajaxresult);\r\n                    if (payloadobject) {\r\n                        switch (payloadobject.success) {\r\n                            case true:\r\n                                log.debug('attempted submission accepted');\r\n                                break;\r\n                            case false:\r\n                            default:\r\n                                log.debug('attempted item evaluation failure');\r\n                                if (payloadobject.message) {\r\n                                    log.debug('message: ' + payloadobject.message);\r\n                                }\r\n                        }\r\n                    }\r\n                },\r\n                fail: notification.exception\r\n            }]);\r\n/*\r\n            return;\r\n\r\n            //set up our ajax request\r\n            var xhr = new XMLHttpRequest();\r\n            var that = this;\r\n\r\n            //set up our handler for the response\r\n            xhr.onreadystatechange = function (e) {\r\n                if (this.readyState === 4) {\r\n                    if (xhr.status === 200) {\r\n                        log.debug('ok we got an attempt submission response');\r\n                        //get a yes or forgetit or tryagain\r\n                        var payload = xhr.responseText;\r\n                        var payloadobject = JSON.parse(payload);\r\n                        if (payloadobject) {\r\n                            switch (payloadobject.success) {\r\n                                case true:\r\n                                    log.debug('attempted submission accepted');\r\n\r\n                                    break;\r\n\r\n                                case false:\r\n                                default:\r\n                                    log.debug('attempted item evaluation failure');\r\n                                    if (payloadobject.message) {\r\n                                        log.debug('message: ' + payloadobject.message);\r\n                                    }\r\n                            }\r\n                        }\r\n                    } else {\r\n                        log.debug('Not 200 response:' + xhr.status);\r\n                    }\r\n                }\r\n            };\r\n\r\n            //to get through mod_security environments\r\n            filename = filename.replace(/^https:\\/\\//i, 'https___');\r\n            var params = \"cmid=\" + that.cmid + \"&filename=\" + encodeURIComponent(filename) + \"&rectime=\" + rectime;\r\n            xhr.open(\"POST\", M.cfg.wwwroot + '/mod/readaloud/ajaxhelper.php', true);\r\n            xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n            xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\r\n            xhr.send(params);\r\n*/\r\n        },\r\n\r\n        domenulayout: function () {\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.feedbackcontainer.hide();\r\n            m.controls.hider.hide();\r\n            m.controls.landrinstructionscontainer.hide();\r\n            landr.deactivate();\r\n            m.controls.modelaudioplayer.hide();\r\n            m.controls.previewinstructionscontainer.hide();\r\n            m.controls.progresscontainer.hide();\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.quizcontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.returnmenubutton.hide();\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.wheretonextcontainer.hide();\r\n\r\n            // Show.\r\n            m.controls.homecontainer.show();\r\n            m.controls.introbox.show();\r\n            m.controls.menuinstructionscontainer.show();\r\n\r\n            m.controls.stopandplay.removeClass('visible').addClass('hidden');\r\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\r\n            m.controls.modeimagecontainer.removeClass('d-block');\r\n            m.controls.modeimagecontainer.addClass('d-none');\r\n\r\n            modelaudiokaraoke.modeling=true;\r\n\r\n            // Update the mode statuses (completed, in-progress, upcoming).\r\n            m.updateModeStatuses();\r\n        },\r\n\r\n        doreadinglayout: function () {\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.feedbackcontainer.hide();\r\n            m.controls.homecontainer.hide();\r\n            m.controls.introbox.hide();\r\n            m.controls.menuinstructionscontainer.hide();\r\n            m.controls.menubuttonscontainer.hide();\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.progresscontainer.hide();\r\n            m.controls.quizcontainer.hide();\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.wheretonextcontainer.hide();\r\n\r\n            // Show.\r\n            m.controls.recordingcontainer.show();\r\n            m.controls.returnmenubutton.show();\r\n            m.controls.hider.fadeOut('fast');\r\n            m.controls.activityinstructionscontainer.show();\r\n\r\n            m.controls.passagecontainer.removeClass('previewmode shadowmode reviewmode nothingmode');\r\n            m.controls.passagecontainer.addClass('readmode');\r\n            m.controls.stopandplay.removeClass('visible').addClass('hidden');\r\n            m.controls.modeimagecontainer.removeClass('fa-comment fa-comments fa-headphones fa-circle-question fa-chart-simple');\r\n            m.controls.modeimagecontainer.addClass('fa-book-open-reader d-block');\r\n\r\n            modelaudiokaraoke.modeling=true;\r\n        },\r\n\r\n        dopreviewlayout: function () {\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.feedbackcontainer.hide();\r\n            m.controls.hider.hide();\r\n            m.controls.homecontainer.hide();\r\n            m.controls.introbox.hide();\r\n            m.controls.landrinstructionscontainer.hide();\r\n            m.controls.menuinstructionscontainer.hide();\r\n            m.controls.modelaudioplayer.hide();\r\n            m.controls.progresscontainer.hide();\r\n            m.controls.quizcontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.stopandplay.show();\r\n            m.controls.wheretonextcontainer.hide();\r\n\r\n            // Show.\r\n            m.controls.passagecontainer.show();\r\n            m.controls.previewinstructionscontainer.show();\r\n            m.controls.returnmenubutton.show();\r\n\r\n            m.controls.passagecontainer.removeClass('readmode shadowmode reviewmode nothingmode');\r\n            m.controls.passagecontainer.addClass('previewmode');\r\n            m.controls.stopandplay.removeClass('hidden').addClass('visible');\r\n            m.controls.modeimagecontainer.removeClass('fa-comment fa-comments fa-book-open-reader fa-circle-question fa-chart-simple');\r\n            m.controls.modeimagecontainer.addClass('fa-headphones d-block');\r\n\r\n            modelaudiokaraoke.modeling=false;\r\n        },\r\n\r\n        dolandrlayout: function () {\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.feedbackcontainer.hide();\r\n            m.controls.homecontainer.hide();\r\n            m.controls.hider.hide();\r\n            m.controls.introbox.hide();\r\n            m.controls.modelaudioplayer.hide();\r\n            m.controls.previewinstructionscontainer.hide();\r\n            m.controls.progresscontainer.hide();\r\n            m.controls.quizcontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.returnmenubutton.show();\r\n            m.controls.smallreportcontainer.hide();\r\n            m.controls.wheretonextcontainer.hide();\r\n\r\n            // Show.\r\n            m.controls.landrinstructionscontainer.show();\r\n            m.controls.passagecontainer.show();\r\n\r\n            m.controls.passagecontainer.removeClass('readmode shadowmode reviewmode nothingmode');\r\n            m.controls.passagecontainer.addClass('previewmode');\r\n            m.controls.stopandplay.removeClass('hidden').addClass('visible');\r\n            m.controls.modeimagecontainer.removeClass('fa-headphones fa-comments fa-book-open-reader fa-circle-question fa-chart-simple');\r\n            m.controls.modeimagecontainer.addClass('fa-comment d-block');\r\n\r\n            landr.activate();\r\n\r\n            modelaudiokaraoke.modeling=false;\r\n        },\r\n\r\n        dopassagelayout: function () {\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.introbox.hide();\r\n\r\n            m.controls.readingcontainer.addClass(def.containerfillscreen);\r\n        },\r\n\r\n        douploadlayout: function () {\r\n            var m = this;\r\n\r\n            m.controls.passagecontainer.addClass(m.passagefinished);\r\n            m.controls.hider.fadeIn('fast');\r\n            m.controls.progresscontainer.fadeIn('fast');\r\n        },\r\n\r\n        dofinishedlayout: function () {\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.quizcontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.returnmenubutton.hide();\r\n            m.controls.smallreportcontainer.hide();\r\n\r\n            // Show.\r\n            m.controls.feedbackcontainer.show();\r\n            m.controls.wheretonextcontainer.show();\r\n\r\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\r\n\r\n            m.controls.hider.fadeOut('fast');\r\n            m.controls.progresscontainer.fadeOut('fast');\r\n\r\n        },\r\n        doerrorlayout: function () {\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.quizcontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n\r\n            // Show.\r\n            m.controls.errorcontainer.show();\r\n            m.controls.wheretonextcontainer.show();\r\n\r\n            m.controls.readingcontainer.removeClass(def.containerfillscreen);\r\n\r\n            m.controls.hider.fadeOut('fast');\r\n            m.controls.progresscontainer.fadeOut('fast');\r\n        },\r\n        doreportlayout: function () {\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.homecontainer.hide();\r\n            m.controls.landrinstructionscontainer.hide();\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.previewinstructionscontainer.hide();\r\n            m.controls.quizcontainer.hide();\r\n            m.controls.recordingcontainer.hide();\r\n\r\n            // Show.\r\n            m.controls.returnmenubutton.show();\r\n            m.controls.smallreportcontainer.show();\r\n\r\n            m.controls.modeimagecontainer.removeClass('fa-headphones fa-comment fa-comments fa-book-open-reader fa-circle-question');\r\n            m.controls.modeimagecontainer.addClass('fa-chart-simple d-block');\r\n        },\r\n        doquizlayout: function(){\r\n            var m = this;\r\n\r\n            // Hide.\r\n            m.controls.activityinstructionscontainer.hide();\r\n            m.controls.homecontainer.hide();\r\n            m.controls.landrinstructionscontainer.hide();\r\n            m.controls.menubuttonscontainer.hide();\r\n            m.controls.passagecontainer.hide();\r\n            m.controls.previewinstructionscontainer.hide();\r\n            m.controls.quizplaceholder.hide();\r\n            m.controls.recordingcontainer.hide();\r\n            m.controls.smallreportcontainer.hide();\r\n\r\n            // Show.\r\n            m.controls.quizcontainer.show();\r\n\r\n            m.controls.stopandplay.removeClass('visible').addClass('hidden');\r\n            m.controls.modeimagecontainer.removeClass('fa-headphones fa-comment fa-comments fa-book-open-reader fa-chart-simple');\r\n            m.controls.modeimagecontainer.addClass('fa-circle-question d-block');\r\n        },\r\n\r\n        updateModeStatuses: function() {\r\n            var dd = this;\r\n\r\n            var stepsOrder = [\r\n                'step_listen',\r\n                'step_practice',\r\n                'step_shadow',\r\n                'step_read',\r\n                'step_quiz',\r\n                'step_report'\r\n            ];\r\n\r\n            var stepsComplete = dd.activitydata.stepscomplete || {};\r\n\r\n            var $container = dd.controls.modejourneycontainer;\r\n            if (!$container || !$container.length) {\r\n                console.error('Mode journey container not found.');\r\n                return;\r\n            }\r\n\r\n            // Flag to ensure only the first incomplete step is marked in-progress.\r\n            var foundIncomplete = false;\r\n\r\n            $container.find('.mode').each(function(index, modeElem) {\r\n                var $mode = $(modeElem);\r\n                var stepName = stepsOrder[index];\r\n\r\n                $mode.removeClass('completed in-progress upcoming');\r\n\r\n                var isComplete = (stepsComplete[stepName] === true || stepsComplete[stepName] === 'true');\r\n\r\n                // If the step is complete, mark it complete.\r\n                if (isComplete) {\r\n                    $mode.addClass('completed');\r\n                }\r\n                // If it's not complete and no incomplete step has been marked yet, mark it as in-progress.\r\n                else if (!foundIncomplete) {\r\n                    $mode.addClass('in-progress');\r\n                    foundIncomplete = true;\r\n                }\r\n                // Otherwise, mark it as upcoming.\r\n                else {\r\n                    $mode.addClass('upcoming');\r\n                }\r\n            });\r\n        },\r\n\r\n        updateBigButtonMenuModeStatus: function() {\r\n            var dd = this;\r\n            var stepsOrder = [\r\n                'step_listen',\r\n                'step_practice',\r\n                'step_shadow',\r\n                'step_read',\r\n                'step_quiz',\r\n                'step_report'\r\n            ];\r\n\r\n            var stepsComplete = dd.activitydata.stepscomplete || {};\r\n\r\n            var $menu = dd.controls.menubuttonscontainer;\r\n            if (!$menu || !$menu.length) {\r\n                console.error('Menu button container not found.');\r\n                return;\r\n            }\r\n\r\n            // Flag to ensure only the first incomplete step is marked \"in-progress\".\r\n            var foundIncomplete = false;\r\n\r\n            $menu.find('li.mode-chooser').each(function(index, liElem) {\r\n                var $li = $(liElem);\r\n                var stepName = stepsOrder[index];\r\n\r\n                var isComplete = (stepsComplete[stepName] === true || stepsComplete[stepName] === 'true');\r\n                var status;\r\n                if (isComplete) {\r\n                    status = 'completed';\r\n                } else if (!foundIncomplete) {\r\n                    status = 'in-progress';\r\n                    foundIncomplete = true;\r\n                } else {\r\n                    status = 'upcoming';\r\n                }\r\n\r\n                // Update the Font Awesome icon accordingly.\r\n                var $iconSpan = $li.find('.nav-icon');\r\n                if ($iconSpan.length) {\r\n                    if (status === 'completed') {\r\n                        $iconSpan.html('<i class=\"fa-solid fa-circle-check text-success\" title=\"Complete\"></i>');\r\n                    } else if (status === 'in-progress') {\r\n                        $iconSpan.html('<i class=\"fa-regular fa-circle text-warning\" title=\"In progress\"></i>');\r\n                    } else { // upcoming.\r\n                        $iconSpan.html('<i class=\"fa-solid fa-lock text-secondary\" title=\"Locked\"></i>');\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        isandroid: function() {\r\n                if (/Android/i.test(navigator.userAgent)) {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n        }\r\n    };//end of returned object\r\n});//total end\r\n"],"names":["define","$","log","str","def","recorderhelper","modelaudiokaraoke","Ajax","notification","smallreporthelper","landr","quizhelper","disableClick","e","preventDefault","stopImmediatePropagation","debug","cmid","activitydata","holderid","recorderid","playerid","sorryboxid","controls","ra_recorder","rec_time_start","steps_enabled","steps_open","steps_complete","letsshadow","strings","passagefinished","clone","extend","this","init","props","dd","stepsenabled","stepsopen","stepscomplete","theid","widgetid","configcontrol","get","JSON","parse","value","remove","is_browser_ok","setupmodelaudio","setuplandr","setup_recorder","process_html","register_events","setup_strings","setupquiz","stepshadow_enabled","steplisten_enabled","domenulayout","show","get_strings","component","done","s","i","confirm_cancel_recording","karaoke_opts","breaks","audioplayerclass","landr_opts","language","region","phonetics","stt_guided","on_complete","update_activity_step","steps","step_practice","attemptid","step_quiz","opts","hider","introbox","progresscontainer","feedbackcontainer","errorcontainer","passagecontainer","recordingcontainer","dummyrecorder","recordercontainer","menubuttonscontainer","menuinstructionscontainer","previewinstructionscontainer","landrinstructionscontainer","activityinstructionscontainer","recinstructionscontainerright","recinstructionscontainerleft","allowearlyexit","wheretonextcontainer","modelaudioplayer","homebutton","startlistenbutton","step_listen","startpracticebutton","startreadbutton","step_read","startshadowbutton","step_shadow","startquizbutton","startreportbutton","returnmenubutton","stopandplay","smallreportcontainer","readingcontainer","modeimagecontainer","modejourneycontainer","quizcontainer","quizplaceholder","quizresultscontainer","homecontainer","navigator","mediaDevices","getUserMedia","beginall","passagerecorded","play","eventdata","Date","getTime","dopassagelayout","scrollIntoView","behaviour","block","inline","douploadlayout","currentTime","pause","rectime","Math","ceil","send_submission","mediaurl","dofinishedlayout","capturedspeech","speechresults","each","addEventListener","click","dopreviewlayout","keypress","which","dolandrlayout","doreadinglayout","isandroid","is","location","reload","hasClass","confirm","doreportlayout","doquizlayout","step","that","call","methodname","args","ajaxresult","adata","key","updateModeStatuses","updateBigButtonMenuModeStatus","open_next_step","fail","exception","oldstep","thestep","step_chooser","length","removeClass","removeEventListener","filename","shadowing","payloadobject","success","message","m","hide","deactivate","addClass","containerfillscreen","modeling","fadeOut","activate","fadeIn","doerrorlayout","stepsOrder","stepsComplete","$container","foundIncomplete","find","index","modeElem","$mode","stepName","console","error","$menu","liElem","status","$li","$iconSpan","html","test","userAgent"],"mappings":"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"}