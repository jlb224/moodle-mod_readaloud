{"version":3,"sources":["../src/activitycontroller.js"],"names":["define","$","jqui","log","def","recorderhelper","modelaudiokaraoke","transcriber","Ajax","notification","debug","cmid","activitydata","holderid","recorderid","playerid","sorryboxid","controls","ra_recorder","rec_time_start","enableshadow","enablepreview","letsshadow","streamingresults","passagefinished","clone","extend","init","props","dd","theid","widgetid","configcontrol","get","JSON","parse","value","remove","is_browser_ok","show","setupmodelaudio","opts","language","region","token","parent","owner","appid","expiretime","transcriber_amazonstreaming","onFinalResult","transcript","result","push","onPartialResult","setup_recorder","process_html","register_events","domenulayout","doreadinglayout","karaoke_opts","breaks","audioplayerclass","hider","introbox","progresscontainer","feedbackcontainer","errorcontainer","passagecontainer","recordingcontainer","dummyrecorder","recordercontainer","menubuttonscontainer","menuinstructionscontainer","activityinstructionscontainer","recinstructionscontainerright","recinstructionscontainerleft","allowearlyexit","wheretonextcontainer","modelaudioplayer","startpreviewbutton","startreadingbutton","startshadowbutton","returnmenubutton","navigator","mediaDevices","getUserMedia","beginall","passagerecorded","play","on_recording_start","Date","getTime","dopassagelayout","active","window","video","audio","then","stream","start","catch","error","on_recording_end","now","douploadlayout","currentTime","pause","closeSocket","on_audio_processing","eventdata","rectime","Math","ceil","length","send_streaming_submission","mediaurl","send_submission","dofinishedlayout","click","dopreviewlayout","fetch_presigned_streaming_url","filename","that","call","methodname","args","awsresults","stringify","done","ajaxresult","payloadobject","success","message","fail","exception","m","fadeOut","hide","addClass","fadeIn","doerrorlayout"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'jqueryui', 'core/log', 'mod_readaloud/definitions',\n        'mod_readaloud/recorderhelper', 'mod_readaloud/modelaudiokaraoke',\n        'mod_readaloud/transcriber-lazy','core/ajax','core/notification'],\n    function ($, jqui, log, def, recorderhelper, modelaudiokaraoke, transcriber, Ajax, notification) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Activity controller: initialising');\n\n    return {\n\n        cmid: null,\n        activitydata: null,\n        holderid: null,\n        recorderid: null,\n        playerid: null,\n        sorryboxid: null,\n        controls: null,\n        ra_recorder: null,\n        rec_time_start: 0,\n        enableshadow: false,\n        enablepreview: false,\n        letsshadow: false,\n        streamingresults: false,\n\n        //CSS in this file\n        passagefinished: def.passagefinished,\n\n        //for making multiple instances\n        clone: function () {\n            return $.extend(true, {}, this);\n        },\n\n        //pass in config, the jquery video/audio object, and a function to be called when conversion has finshed\n        init: function (props) {\n            var dd = this.clone();\n\n            //pick up opts from html\n            var theid = '#amdopts_' + props.widgetid;\n            var configcontrol = $(theid).get(0);\n            if (configcontrol) {\n                dd.activitydata = JSON.parse(configcontrol.value);\n                $(theid).remove();\n            } else {\n                //if there is no config we might as well give up\n                log.debug('Read Aloud Test Controller: No config found on page. Giving up.');\n                return;\n            }\n\n            dd.cmid = props.cmid;\n            dd.holderid = props.widgetid + '_holder';\n            dd.recorderid = props.widgetid + '_recorder';\n            dd.playerid = props.widgetid + '_player';\n            dd.sorryboxid = props.widgetid + '_sorrybox';\n\n            //if the browser doesn't support html5 recording.\n            //then warn and do not go any further\n            if (!dd.is_browser_ok()) {\n                $('#' + dd.sorryboxid).show();\n                return;\n            }\n\n            //set up model audio\n            dd.enableshadow =dd.activitydata.enableshadow;\n            dd.enablepreview =dd.activitydata.enablepreview;\n            dd.setupmodelaudio();\n\n            //init streaming transcriber\n            var opts={};\n            opts['language']=dd.activitydata.language;\n            opts['region']=dd.activitydata.region;\n            //opts['accessid']=dd.activitydata.accessid;\n            //opts['secretkey']=dd.activitydata.secretkey;\n            opts['token'] = dd.activitydata.token;\n            opts['parent'] = dd.activitydata.parent;\n            opts['owner'] = dd.activitydata.owner;\n            opts['appid'] = dd.activitydata.appid;\n            opts['expiretime'] = dd.activitydata.expiretime;\n            opts['transcriber']=dd.activitydata.transcriber;\n            if(opts['transcriber'] == def.transcriber_amazonstreaming) {\n                transcriber.init(opts);\n                transcriber.onFinalResult = function (transcript, result) {\n                    dd.streamingresults.push(result);\n                    //if recording over deal with final result\n                    //if(!transcriber.active){\n                    log.debug(dd.streamingresults);\n                    //}\n\n                    // theCallback(message);\n                };\n                transcriber.onPartialResult = function (transcript, result) {\n                    //do nothing\n                };\n            }\n\n            //init recorder and html and events\n            dd.setup_recorder();\n            dd.process_html(dd.activitydata);\n            dd.register_events();\n\n            //set initial mode\n            if(dd.enableshadow || dd.enablepreview){\n                dd.domenulayout();\n            }else{\n                dd.doreadinglayout();\n            }\n        },\n\n        setupmodelaudio: function(){\n            var karaoke_opts={breaks:this.activitydata.breaks, audioplayerclass:this.activitydata.audioplayerclass };\n            modelaudiokaraoke.init(karaoke_opts);\n        },\n\n        process_html: function (opts) {\n\n            //these css classes/ids are all passed in from php in\n            //renderer.php::fetch_activity_amd should maybe just simplify and declare them in definitions.js\n            var controls = {\n                hider: $('.' + opts['hider']),\n                introbox: $('.' + 'mod_intro_box'),\n                progresscontainer: $('.' + opts['progresscontainer']),\n                feedbackcontainer: $('.' + opts['feedbackcontainer']),\n                errorcontainer: $('.' + opts['errorcontainer']),\n                passagecontainer: $('.' + opts['passagecontainer']),\n                recordingcontainer: $('.' + opts['recordingcontainer']),\n                dummyrecorder: $('.' + opts['dummyrecorder']),\n                recordercontainer: $('.' + opts['recordercontainer']),\n                menubuttonscontainer: $('.' + opts['menubuttonscontainer']),\n                menuinstructionscontainer: $('.' + opts['menuinstructionscontainer']),\n                activityinstructionscontainer: $('.' + opts['activityinstructionscontainer']),\n                recinstructionscontainerright: $('.' + opts['recinstructionscontainerright']),\n                recinstructionscontainerleft: $('.' + opts['recinstructionscontainerleft']),\n                allowearlyexit: $('.' + opts['allowearlyexit']),\n                wheretonextcontainer: $('.' + opts['wheretonextcontainer']),\n                modelaudioplayer: $('#' + opts['modelaudioplayer']),\n                startpreviewbutton: $('#' + opts['startpreviewbutton']),\n                startreadingbutton: $('#' + opts['startreadingbutton']),\n                startshadowbutton: $('#' + opts['startshadowbutton']),\n                returnmenubutton: $('#' + opts['returnmenubutton'])\n            };\n            this.controls = controls;\n        },\n\n        is_browser_ok: function () {\n            return (navigator && navigator.mediaDevices\n                && navigator.mediaDevices.getUserMedia);\n        },\n\n        setup_recorder: function () {\n            var dd = this;\n\n            //after the recorder reports that it has (really) started this functuon is called.\n            var beginall= function(){\n                dd.passagerecorded = true;\n                if(dd.enableshadow && dd.letsshadow){\n                    dd.controls.modelaudioplayer[0].play();\n                }\n            };\n\n            //originates from the recording:started event\n            //contains no meaningful data\n            //See https://api.poodll.com\n            var on_recording_start = function (eventdata) {\n                dd.rec_time_start = new Date().getTime();\n                dd.dopassagelayout();\n                dd.controls.passagecontainer.show(1000, beginall);\n\n                //start streaming transcriber\n                if(dd.activitydata.transcriber == def.transcriber_amazonstreaming) {\n                    if (transcriber.active) {\n                        return;\n                    }\n                    //init our streamingresults\n                    dd.streamingresults = [];\n                    // first we get the microphone input from the browser (as a promise)...\n                    window.navigator.mediaDevices.getUserMedia({\n                        video: false,\n                        audio: true,\n                    }).then(function (stream) {\n                        transcriber.start(stream, transcriber)\n                    }).catch(function (error) {\n                            log.debug(error);\n                            log.debug('There was an error streaming your audio to Amazon Transcribe. Please try again.');\n                        }\n                    );\n                }//end of if amazonstreaming\n            };\n\n            //originates from the recording:ended event\n            //contains no meaningful data\n            //See https://api.poodll.com\n            var on_recording_end = function (eventdata) {\n                //its a bit hacky but the rec end event can arrive immed. somehow probably when the mic test ends\n                var now = new Date().getTime();\n                if ((now - dd.rec_time_start) < 3000) {\n                    return;\n                }\n                dd.douploadlayout();\n                //if we are shadowing we should stop the audio player.\n                if(dd.enableshadow && dd.letsshadow){\n                    dd.controls.modelaudioplayer[0].currentTime=0;\n                    dd.controls.modelaudioplayer[0].pause();\n                }\n\n                //stop streaming transcriber\n                if(dd.activitydata.transcriber == def.transcriber_amazonstreaming) {\n                    if (!transcriber.active) {\n                        return;\n                    }\n                    transcriber.closeSocket();\n                }\n            };\n\n            //data sent here originates from the awaiting_processing event\n            //See https://api.poodll.com\n            var on_audio_processing = function (eventdata) {\n                //at this point we know the submission has been uploaded and we know the fileURL\n                //so we send the submission\n                var now = new Date().getTime();\n                var rectime = now - dd.rec_time_start;\n                if (rectime > 0) {\n                    rectime = Math.ceil(rectime / 1000);\n                }\n\n                if(dd.activitydata.transcriber == def.transcriber_amazonstreaming &&\n                    dd.streamingresults &&\n                    dd.streamingresults.length > 0){\n                    dd.send_streaming_submission(eventdata.mediaurl, rectime, dd.streamingresults);\n                }else {\n                    dd.send_submission(eventdata.mediaurl, rectime);\n                }\n                //and let the user know that they are all done\n                dd.dofinishedlayout();\n            };\n\n            //init the recorder\n            recorderhelper.init(dd.activitydata,\n                on_recording_start,\n                on_recording_end,\n                on_audio_processing);\n        },\n\n        register_events: function () {\n            var dd = this;\n            dd.controls.startpreviewbutton.click(function(){\n                dd.dopreviewlayout();\n            });\n            dd.controls.startreadingbutton.click(function(){\n                dd.letsshadow=false;\n                dd.doreadinglayout();\n            });\n            dd.controls.startshadowbutton.click(function(){\n                dd.letsshadow=true;\n                dd.doreadinglayout();\n            });\n            dd.controls.returnmenubutton.click(function(){\n                dd.controls.modelaudioplayer[0].currentTime=0;\n                dd.controls.modelaudioplayer[0].pause();\n                dd.domenulayout();\n            });\n        },\n\n        fetch_presigned_streaming_url: function (filename, samplerate, expiretime) {\n            var that = this;\n            Ajax.call([{\n                methodname: 'local_cpapi_fetch_streamingtranscriber',\n                args: {\n                    cmid: that.cmid,\n                    filename: filename,//encodeURIComponent(filename),\n                    rectime: rectime,\n                    awsresults: JSON.stringify(streamingresults)\n                },\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch (payloadobject.success) {\n                            case true:\n                                log.debug('attempted submission accepted');\n\n                                break;\n\n                            case false:\n                            default:\n                                log.debug('attempted item evaluation failure');\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n        },\n\n        send_streaming_submission: function (filename, rectime, streamingresults) {\n            var that = this;\n            Ajax.call([{\n                methodname: 'mod_readaloud_submit_streaming_attempt',\n                args: {\n                    cmid: that.cmid,\n                    filename: filename,//encodeURIComponent(filename),\n                    rectime: rectime,\n                    awsresults: JSON.stringify(streamingresults)\n                },\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch (payloadobject.success) {\n                            case true:\n                                log.debug('attempted submission accepted');\n\n                                break;\n\n                            case false:\n                            default:\n                                log.debug('attempted item evaluation failure');\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n        },\n\n        send_submission: function (filename, rectime) {\n            var that = this;\n            Ajax.call([{\n                methodname: 'mod_readaloud_submit_regular_attempt',\n                args: {\n                    cmid: that.cmid,\n                    filename:  filename,//encodeURIComponent(filename),\n                    rectime: rectime\n                },\n                done: function(ajaxresult){\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch (payloadobject.success) {\n                            case true:\n                                log.debug('attempted submission accepted');\n\n                                break;\n\n                            case false:\n                            default:\n                                log.debug('attempted item evaluation failure');\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n/*\n            return;\n\n            //set up our ajax request\n            var xhr = new XMLHttpRequest();\n            var that = this;\n\n            //set up our handler for the response\n            xhr.onreadystatechange = function (e) {\n                if (this.readyState === 4) {\n                    if (xhr.status === 200) {\n                        log.debug('ok we got an attempt submission response');\n                        //get a yes or forgetit or tryagain\n                        var payload = xhr.responseText;\n                        var payloadobject = JSON.parse(payload);\n                        if (payloadobject) {\n                            switch (payloadobject.success) {\n                                case true:\n                                    log.debug('attempted submission accepted');\n\n                                    break;\n\n                                case false:\n                                default:\n                                    log.debug('attempted item evaluation failure');\n                                    if (payloadobject.message) {\n                                        log.debug('message: ' + payloadobject.message);\n                                    }\n                            }\n                        }\n                    } else {\n                        log.debug('Not 200 response:' + xhr.status);\n                    }\n                }\n            };\n\n            //to get through mod_security environments\n            filename = filename.replace(/^https:\\/\\//i, 'https___');\n            var params = \"cmid=\" + that.cmid + \"&filename=\" + encodeURIComponent(filename) + \"&rectime=\" + rectime;\n            xhr.open(\"POST\", M.cfg.wwwroot + '/mod/readaloud/ajaxhelper.php', true);\n            xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n            xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\n            xhr.send(params);\n*/\n        },\n\n        doreadinglayout: function () {\n            var m = this;\n            m.controls.hider.fadeOut('fast');\n            m.controls.activityinstructionscontainer.show();\n            m.controls.recordingcontainer.show();\n            m.controls.menuinstructionscontainer.hide();\n            m.controls.menubuttonscontainer.hide();\n            m.controls.returnmenubutton.show();\n            m.controls.progresscontainer.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.feedbackcontainer.hide();\n            m.controls.wheretonextcontainer.hide();\n        },\n\n        domenulayout: function () {\n            var m = this;\n            m.controls.menuinstructionscontainer.show();\n            m.controls.menubuttonscontainer.show();\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.returnmenubutton.hide();\n            m.controls.progresscontainer.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.feedbackcontainer.hide();\n            m.controls.wheretonextcontainer.hide();\n            m.controls.modelaudioplayer.hide();\n            m.controls.hider.hide();\n        },\n\n        dopreviewlayout: function () {\n            var m = this;\n            m.controls.passagecontainer.show();\n            m.controls.returnmenubutton.show();\n            m.controls.modelaudioplayer.show();\n            m.controls.menubuttonscontainer.hide();\n            m.controls.hider.hide();\n            m.controls.progresscontainer.hide();\n            m.controls.menuinstructionscontainer.hide();\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.feedbackcontainer.hide();\n            m.controls.wheretonextcontainer.hide();\n        },\n\n\n        dopassagelayout: function () {\n            var m = this;\n            m.controls.introbox.hide();\n        },\n\n        douploadlayout: function () {\n            var m = this;\n            m.controls.passagecontainer.addClass(m.passagefinished);\n            m.controls.hider.fadeIn('fast');\n            m.controls.progresscontainer.fadeIn('fast');\n        },\n\n        dofinishedlayout: function () {\n            var m = this;\n            m.controls.hider.fadeOut('fast');\n            m.controls.progresscontainer.fadeOut('fast');\n            m.controls.activityinstructionscontainer.hide();\n            m.controls.passagecontainer.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.feedbackcontainer.show();\n            m.controls.wheretonextcontainer.show();\n        },\n        doerrorlayout: function () {\n            var m = this;\n            m.controls.hider.fadeOut('fast');\n            m.controls.progresscontainer.fadeOut('fast');\n            m.controls.passagecontainer.hide();\n            m.controls.recordingcontainer.hide();\n            m.controls.errorcontainer.show();\n            m.controls.wheretonextcontainer.show();\n        }\n    };//end of returned object\n});//total end\n"],"file":"activitycontroller.min.js"}