{"version":3,"sources":["../src/modelaudiokaraoke.js"],"names":["define","$","log","def","debug","controls","breaks","endwordnumber","currentstartbreak","modeling","cd","audioplayerclass","wordplayerclass","wordclass","spaceclass","endspaceclass","passagecontainer","activesentence","stopbutton","playbutton","init","opts","JSON","parse","register_controls","eachword","length","register_events","set_breaks","sort_breaks","sort","a","b","audiotime","audioplayer","eachspace","eachwordorspace","that","aplayer","on","play","pause","wordnumber","parseInt","attr","nearest_start_break","i","currentTime","ended","removeClass","onended","onpause","ontimeupdate","startbreak","nextbreak","thewordnumber","addClass"],"mappings":"AAAAA,OAAM,mCAAC,CAAC,QAAD,CAAW,UAAX,CAAsB,2BAAtB,CAAD,CAAqD,SAAUC,CAAV,CAAaC,CAAb,CAAkBC,CAAlB,CAAuB,CAC9E,aAKAD,CAAG,CAACE,KAAJ,CAAU,kCAAV,EAEA,MAAO,CACHC,QAAQ,CAAE,EADP,CAEHC,MAAM,CAAE,EAFL,CAGHC,aAAa,CAAE,CAHZ,CAIHC,iBAAiB,GAJd,CAKHC,QAAQ,GALL,CAQHC,EAAE,CAAE,CACAC,gBAAgB,CAAER,CAAG,CAACQ,gBADtB,CAEAC,eAAe,CAAET,CAAG,CAACS,eAFrB,CAGAC,SAAS,CAAEV,CAAG,CAACU,SAHf,CAIAC,UAAU,CAAEX,CAAG,CAACW,UAJhB,CAKAC,aAAa,CAAEZ,CAAG,CAACY,aALnB,CAMAC,gBAAgB,CAAEb,CAAG,CAACa,gBANtB,CAOAC,cAAc,CAAEd,CAAG,CAACc,cAPpB,CAQAC,UAAU,CAAE,2BARZ,CASAC,UAAU,CAAE,2BATZ,CARD,CAqBHC,IAAI,CAAE,cAASC,CAAT,CAAc,CAChB,GAAGA,CAAI,CAACf,MAAR,CAAgB,CACZ,KAAKA,MAAL,CAAYgB,IAAI,CAACC,KAAL,CAAWF,CAAI,CAACf,MAAhB,CACf,CACD,GAAGe,CAAI,CAACZ,QAAR,CAAkB,CACd,KAAKA,QAAL,GACH,CACD,GAAGY,CAAI,CAACV,gBAAR,CAA0B,CACtB,KAAKD,EAAL,CAAQC,gBAAR,CAAyBU,CAAI,CAACV,gBACjC,CAGD,KAAKa,iBAAL,GAGA,KAAKjB,aAAL,CAAqB,KAAKF,QAAL,CAAcoB,QAAd,CAAuBC,MAA5C,CAGA,KAAKC,eAAL,EACH,CAxCE,CA0CHC,UAAU,CAAE,oBAAStB,CAAT,CAAgB,CACxB,KAAKA,MAAL,CAAYA,CAAZ,CACA,KAAKuB,WAAL,EACH,CA7CE,CA+CHA,WAAW,CAAE,sBAAU,CACnB,KAAKvB,MAAL,CAAYwB,IAAZ,CAAiB,SAASC,CAAT,CAAYC,CAAZ,CAAc,CAAC,MAAOD,CAAAA,CAAC,CAACE,SAAF,CAAcD,CAAC,CAACC,SAAU,CAAjE,CACH,CAjDE,CAoDHT,iBAAiB,CAAE,4BAAU,CACzB,KAAKnB,QAAL,CAAc6B,WAAd,CAA4BjC,CAAC,CAAC,IAAM,KAAKS,EAAL,CAAQC,gBAAf,CAA7B,CACA,KAAKN,QAAL,CAAcoB,QAAd,CAAyBxB,CAAC,CAAC,IAAM,KAAKS,EAAL,CAAQG,SAAf,CAA1B,CACA,KAAKR,QAAL,CAAc8B,SAAd,CAA0BlC,CAAC,CAAC,IAAM,KAAKS,EAAL,CAAQI,UAAf,CAA3B,CACA,KAAKT,QAAL,CAAc+B,eAAd,CAAgCnC,CAAC,CAAC,IAAM,KAAKS,EAAL,CAAQI,UAAd,CAA2B,IAA3B,CAAkC,KAAKJ,EAAL,CAAQG,SAA3C,CAAjC,CACA,KAAKR,QAAL,CAAcW,gBAAd,CAAiCf,CAAC,CAAC,IAAM,KAAKS,EAAL,CAAQM,gBAAf,CAAlC,CACA,KAAKX,QAAL,CAAca,UAAd,CAA2BjB,CAAC,CAAC,IAAM,KAAKS,EAAL,CAAQQ,UAAf,CAA5B,CACA,KAAKb,QAAL,CAAcc,UAAd,CAA2BlB,CAAC,CAAC,IAAM,KAAKS,EAAL,CAAQS,UAAf,CAC/B,CA5DE,CA+DHQ,eAAe,CAAE,0BAAW,IACpBU,CAAAA,CAAI,CAAG,IADa,CAIpBC,CAAO,CAAG,KAAKjC,QAAL,CAAc6B,WAAd,CAA0B,CAA1B,CAJU,CAMxB,KAAK7B,QAAL,CAAcc,UAAd,CAAyBoB,EAAzB,CAA4B,OAA5B,CAAoC,UAAU,CAC5CD,CAAO,CAACE,IAAR,EACD,CAFD,EAIA,KAAKnC,QAAL,CAAca,UAAd,CAAyBqB,EAAzB,CAA4B,OAA5B,CAAoC,UAAU,CAC5CD,CAAO,CAACG,KAAR,EACD,CAFD,EAMA,GAAG,CAAC,KAAKhC,QAAT,CAAmB,CACf,KAAKJ,QAAL,CAAc+B,eAAd,CAA8BG,EAA9B,CAAiC,OAAjC,CAA0C,UAAY,CAGlD,OAFIG,CAAAA,CAAU,CAAGC,QAAQ,CAAC1C,CAAC,CAAC,IAAD,CAAD,CAAQ2C,IAAR,CAAa,iBAAb,CAAD,CAEzB,CADIC,CAAmB,GACvB,CAASC,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGT,CAAI,CAAC/B,MAAL,CAAYoB,MAAhC,CAAwCoB,CAAC,EAAzC,CAA6C,CACzC,GAAIT,CAAI,CAAC/B,MAAL,CAAYwC,CAAZ,EAAeJ,UAAf,CAA4BA,CAAhC,CAA4C,CACxCG,CAAmB,CAAGR,CAAI,CAAC/B,MAAL,CAAYwC,CAAZ,CACzB,CAFD,IAEO,CAEH,KACH,CACJ,CACD,IAAI,CAACD,CAAL,CAEO,CACHP,CAAO,CAACG,KAAR,GACAH,CAAO,CAACS,WAAR,CAAsBF,CAAmB,CAACZ,SAA1C,CACAK,CAAO,CAACE,IAAR,EACH,CACJ,CAlBD,CAmBH,CAGD,GAAIQ,CAAAA,CAAK,CAAG,UAAU,CAClBX,CAAI,CAAChC,QAAL,CAAcoB,QAAd,CAAuBwB,WAAvB,CAAmCZ,CAAI,CAAC3B,EAAL,CAAQO,cAA3C,EACAoB,CAAI,CAAChC,QAAL,CAAc8B,SAAd,CAAwBc,WAAxB,CAAoCZ,CAAI,CAAC3B,EAAL,CAAQO,cAA5C,EACAoB,CAAI,CAAC7B,iBAAL,GACH,CAJD,CAMA8B,CAAO,CAACY,OAAR,CAAiBF,CAAjB,CACAV,CAAO,CAACa,OAAR,CAAiBH,CAAjB,CAEAV,CAAO,CAACc,YAAR,CAAuB,UAAY,CAI/B,OAHIL,CAAAA,CAAW,CAAGT,CAAO,CAACS,WAG1B,CAFIM,CAAU,GAEd,CADIC,CAAS,GACb,CAASR,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGT,CAAI,CAAC/B,MAAL,CAAYoB,MAAhC,CAAwCoB,CAAC,EAAzC,CAA6C,CAEzC,GAAIC,CAAW,EAAIV,CAAI,CAAC/B,MAAL,CAAYwC,CAAZ,EAAeb,SAA9B,EAA2Ca,CAAC,CAAG,CAAJ,GAAUT,CAAI,CAAC/B,MAAL,CAAYoB,MAArE,CAA6E,CACzE2B,CAAU,CAAGhB,CAAI,CAAC/B,MAAL,CAAYwC,CAAZ,CAAb,CACAQ,CAAS,CAAG,CAACZ,UAAU,CAAEL,CAAI,CAAC9B,aAAL,CAAqB,CAAlC,CAAqC0B,SAAS,CAAE,CAAhD,CAEf,CAJD,IAIO,IAAIc,CAAW,EAAIV,CAAI,CAAC/B,MAAL,CAAYwC,CAAZ,EAAeb,SAA9B,EAA2Cc,CAAW,CAAGV,CAAI,CAAC/B,MAAL,CAAYwC,CAAC,CAAG,CAAhB,EAAmBb,SAAhF,CAA2F,CAC9FoB,CAAU,CAAGhB,CAAI,CAAC/B,MAAL,CAAYwC,CAAZ,CAAb,CACAQ,CAAS,CAAGjB,CAAI,CAAC/B,MAAL,CAAYwC,CAAC,CAAG,CAAhB,CAAZ,CACA,KAEH,CALM,IAKA,IAAO,CAAJ,GAAAA,CAAC,EAAQC,CAAW,CAAGV,CAAI,CAAC/B,MAAL,CAAYwC,CAAZ,EAAeb,SAAtC,EAAiE,CAAd,CAAAc,CAAtD,CAAsE,CACzEM,CAAU,CAAG,CAACX,UAAU,CAAE,CAAb,CAAgBT,SAAS,CAAE,CAA3B,CAAb,CACAqB,CAAS,CAAGjB,CAAI,CAAC/B,MAAL,CAAYwC,CAAZ,CAEf,CACJ,CAED,KAAIT,CAAI,CAAC7B,iBAAL,EAA0B6C,CAA9B,EAGO,CACHhB,CAAI,CAAC7B,iBAAL,CAAyB6C,CAAzB,CACAhB,CAAI,CAAChC,QAAL,CAAcoB,QAAd,CAAuBwB,WAAvB,CAAmCZ,CAAI,CAAC3B,EAAL,CAAQO,cAA3C,EACAoB,CAAI,CAAChC,QAAL,CAAc8B,SAAd,CAAwBc,WAAxB,CAAoCZ,CAAI,CAAC3B,EAAL,CAAQO,cAA5C,EACA,GAAI,KAAAoC,CAAU,EAAc,KAAAC,CAA5B,CAAiD,CAC7C,IAAK,GAAIC,CAAAA,CAAa,CAAGF,CAAU,CAACX,UAAX,CAAsB,CAA/C,CAAkDa,CAAa,EAAID,CAAS,CAACZ,UAA7E,CAAyFa,CAAa,EAAtG,CAA0G,CACtGtD,CAAC,CAAC,IAAMoC,CAAI,CAAC3B,EAAL,CAAQI,UAAd,CAA2B,GAA3B,CAAiCyC,CAAlC,CAAD,CAAkDC,QAAlD,CAA4DnB,CAAI,CAAC3B,EAAL,CAAQO,cAApE,EACAhB,CAAC,CAAC,IAAMoC,CAAI,CAAC3B,EAAL,CAAQG,SAAd,CAA0B,GAA1B,CAAgC0C,CAAjC,CAAD,CAAiDC,QAAjD,CAA2DnB,CAAI,CAAC3B,EAAL,CAAQO,cAAnE,CACH,CACJ,CACJ,CACJ,CACJ,CApJE,CAuJV,CA/JK,CAAN","sourcesContent":["define(['jquery', 'core/log','mod_readaloud/definitions'], function ($, log, def) {\n    \"use strict\"; // jshint ;_;\n    /*\n    This file helps you get Polly URLs at runtime\n     */\n\n    log.debug('Model Audio helper: initialising');\n\n    return {\n        controls: {},\n        breaks: [],\n        endwordnumber: 0,\n        currentstartbreak: false,\n        modeling: false,\n\n        //class definitions\n        cd: {\n            audioplayerclass: def.audioplayerclass,\n            wordplayerclass: def.wordplayerclass,\n            wordclass: def.wordclass,\n            spaceclass: def.spaceclass,\n            endspaceclass: def.endspaceclass,\n            passagecontainer: def.passagecontainer,\n            activesentence: def.activesentence,\n            stopbutton: 'mod_readaloud_button_stop',\n            playbutton: 'mod_readaloud_button_play'\n        },\n\n        //init the module\n        init: function(opts){\n            if(opts.breaks) {\n                this.breaks=JSON.parse(opts.breaks);\n            }\n            if(opts.modeling) {\n                this.modeling=true;\n            }\n            if(opts.audioplayerclass) {\n                this.cd.audioplayerclass=opts.audioplayerclass;\n            }\n\n            //register the controls\n            this.register_controls();\n\n            //register the end word number\n            this.endwordnumber = this.controls.eachword.length;\n\n            //register the events\n            this.register_events();\n        },\n\n        set_breaks: function(breaks){\n            this.breaks=breaks;\n            this.sort_breaks();\n        },\n\n        sort_breaks: function(){\n            this.breaks.sort(function(a, b){return a.audiotime - b.audiotime});\n        },\n\n        //load all the controls so we do not have to do it later\n        register_controls: function(){\n            this.controls.audioplayer = $('#' + this.cd.audioplayerclass);\n            this.controls.eachword = $('.' + this.cd.wordclass);\n            this.controls.eachspace = $('.' + this.cd.spaceclass);\n            this.controls.eachwordorspace = $('.' + this.cd.spaceclass + ',.' + this.cd.wordclass);\n            this.controls.passagecontainer = $(\".\" + this.cd.passagecontainer);\n            this.controls.stopbutton = $('#' + this.cd.stopbutton);\n            this.controls.playbutton = $('#' + this.cd.playbutton);\n        },\n\n        //attach the various event handlers we need\n        register_events: function() {\n            var that = this;\n\n            // Get the audio element\n            var aplayer = this.controls.audioplayer[0];\n          \n            this.controls.playbutton.on('click',function(){\n              aplayer.play();\n            });\n          \n            this.controls.stopbutton.on('click',function(){\n              aplayer.pause();\n            });\n\n            //if we are not modeling we want to jump to the clicked location\n            //if we are modeling the meaning of a click is to place a marker, so we do not want to jump\n            if(!this.modeling) {\n                this.controls.eachwordorspace.on('click', function () {\n                    var wordnumber = parseInt($(this).attr('data-wordnumber'));\n                    var nearest_start_break = false;\n                    for (var i = 0; i < that.breaks.length; i++) {\n                        if (that.breaks[i].wordnumber < wordnumber) {\n                            nearest_start_break = that.breaks[i];\n                        } else {\n                            //exit the loop;\n                            break;\n                        }\n                    }\n                    if (!nearest_start_break) {\n                        //start from beginning OR do nothing\n                    } else {\n                        aplayer.pause();\n                        aplayer.currentTime = nearest_start_break.audiotime;\n                        aplayer.play();\n                    }\n                });//end of eachwordorspace\n            }//end of if not modeling\n\n            //Player events (onended, onpause, ontimeupdate)\n            var ended = function(){\n                that.controls.eachword.removeClass(that.cd.activesentence);\n                that.controls.eachspace.removeClass(that.cd.activesentence);\n                that.currentstartbreak = false;\n            };\n\n            aplayer.onended= ended;\n            aplayer.onpause= ended;\n\n            aplayer.ontimeupdate = function () {\n                var currentTime = aplayer.currentTime;\n                var startbreak = false;\n                var nextbreak = false;\n                for (var i = 0; i < that.breaks.length; i++) {\n                    //if this is the last marked break (ie flow till end)\n                    if (currentTime >= that.breaks[i].audiotime && i + 1 === that.breaks.length) {\n                        startbreak = that.breaks[i];\n                        nextbreak = {wordnumber: that.endwordnumber + 1, audiotime: 0};\n                        //if its just between two breaks (yay)\n                    } else if (currentTime >= that.breaks[i].audiotime && currentTime < that.breaks[i + 1].audiotime) {\n                        startbreak = that.breaks[i];\n                        nextbreak = that.breaks[i + 1];\n                        break;\n                     //this is the first section\n                    } else if(i===0 && currentTime < that.breaks[i].audiotime && currentTime > 0){\n                        startbreak = {wordnumber: 0, audiotime: 0};\n                        nextbreak = that.breaks[i];\n\n                    }\n                }\n                //nothing changed since last time\n                if (that.currentstartbreak == startbreak) {\n                    //do nothing\n                    //oooh, new current break!!\n                } else {\n                    that.currentstartbreak = startbreak;\n                    that.controls.eachword.removeClass(that.cd.activesentence);\n                    that.controls.eachspace.removeClass(that.cd.activesentence);\n                    if (startbreak !== false && nextbreak !== false) {\n                        for (var thewordnumber = startbreak.wordnumber+1; thewordnumber <= nextbreak.wordnumber; thewordnumber++) {\n                            $('#' + that.cd.spaceclass + '_' + thewordnumber).addClass((that.cd.activesentence));\n                            $('#' + that.cd.wordclass + '_' + thewordnumber).addClass((that.cd.activesentence));\n                        }\n                    }\n                }\n            };\n        }//end of register events\n\n    };//end of return value\n});"],"file":"modelaudiokaraoke.min.js"}