{"version":3,"sources":["../src/modelaudiokaraoke.js"],"names":["define","$","log","def","debug","controls","breaks","endwordnumber","currentstartbreak","cd","audioplayerclass","wordplayerclass","wordclass","spaceclass","endspaceclass","passagecontainer","activesentence","stopbutton","playbutton","init","opts","JSON","parse","register_controls","eachword","length","register_events","set_breaks","sort_breaks","sort","a","b","audiotime","audioplayer","eachspace","that","aplayer","on","play","pause","ended","removeClass","onended","onpause","ontimeupdate","currentTime","startbreak","nextbreak","i","wordnumber","thewordnumber","addClass"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log','mod_readaloud/definitions'], function ($, log, def) {\n    \"use strict\"; // jshint ;_;\n    /*\n    This file helps you get Polly URLs at runtime\n     */\n\n    log.debug('Model Audio helper: initialising');\n\n    return {\n        controls: {},\n        breaks: [],\n        endwordnumber: 0,\n        currentstartbreak: false,\n\n        //class definitions\n        cd: {\n            audioplayerclass: def.audioplayerclass,\n            wordplayerclass: def.wordplayerclass,\n            wordclass: def.wordclass,\n            spaceclass: def.spaceclass,\n            endspaceclass: def.endspaceclass,\n            passagecontainer: def.passagecontainer,\n            activesentence: def.activesentence,\n            stopbutton: 'mod_readaloud_button_stop',\n            playbutton: 'mod_readaloud_button_play'\n        },\n\n        //init the module\n        init: function(opts){\n            if(opts.breaks) {\n                this.breaks=JSON.parse(opts.breaks);\n            }\n            if(opts.audioplayerclass) {\n                this.cd.audioplayerclass=opts.audioplayerclass;\n            }\n\n            //register the controls\n            this.register_controls();\n\n            //register the end word number\n            this.endwordnumber = this.controls.eachword.length;\n\n            //register the events\n            this.register_events();\n        },\n\n        set_breaks: function(breaks){\n            this.breaks=breaks;\n            this.sort_breaks();\n        },\n\n        sort_breaks: function(){\n            this.breaks.sort(function(a, b){return a.audiotime - b.audiotime});\n        },\n\n        //load all the controls so we do not have to do it later\n        register_controls: function(){\n            this.controls.audioplayer = $('#' + this.cd.audioplayerclass);\n            this.controls.eachword = $('.' + this.cd.wordclass);\n            this.controls.eachspace = $('.' + this.cd.spaceclass);\n            this.controls.passagecontainer = $(\".\" + this.cd.passagecontainer);\n            this.controls.stopbutton = $('#' + this.cd.stopbutton);\n            this.controls.playbutton = $('#' + this.cd.playbutton);\n        },\n\n        //attach the various event handlers we need\n        register_events: function() {\n            var that = this;\n\n            // Get the audio element\n            var aplayer = this.controls.audioplayer[0];\n          \n            this.controls.playbutton.on('click',function(){\n              aplayer.play();\n            });\n          \n            this.controls.stopbutton.on('click',function(){\n              aplayer.pause();\n            });\n\n            //Player events (onended, onpause, ontimeupdate)\n            var ended = function(){\n                that.controls.eachword.removeClass(that.cd.activesentence);\n                that.controls.eachspace.removeClass(that.cd.activesentence);\n                that.currentstartbreak = false;\n            };\n\n            aplayer.onended= ended;\n            aplayer.onpause= ended;\n\n            aplayer.ontimeupdate = function () {\n                var currentTime = aplayer.currentTime;\n                var startbreak = false;\n                var nextbreak = false;\n                for (var i = 0; i < that.breaks.length; i++) {\n                    //if this is the last marked break (ie flow till end)\n                    if (currentTime >= that.breaks[i].audiotime && i + 1 === that.breaks.length) {\n                        startbreak = that.breaks[i];\n                        nextbreak = {wordnumber: that.endwordnumber + 1, audiotime: 0};\n                        //if its just between two breaks (yay)\n                    } else if (currentTime >= that.breaks[i].audiotime && currentTime < that.breaks[i + 1].audiotime) {\n                        startbreak = that.breaks[i];\n                        nextbreak = that.breaks[i + 1];\n                        break;\n                     //this is the first section\n                    } else if(i===0 && currentTime < that.breaks[i].audiotime && currentTime > 0){\n                        startbreak = {wordnumber: 0, audiotime: 0};\n                        nextbreak = that.breaks[i];\n\n                    }\n                }\n                //nothing changed since last time\n                if (that.currentstartbreak == startbreak) {\n                    //do nothing\n                    //oooh, new current break!!\n                } else {\n                    that.currentstartbreak = startbreak;\n                    that.controls.eachword.removeClass(that.cd.activesentence);\n                    that.controls.eachspace.removeClass(that.cd.activesentence);\n                    if (startbreak !== false && nextbreak !== false) {\n                        for (var thewordnumber = startbreak.wordnumber+1; thewordnumber <= nextbreak.wordnumber; thewordnumber++) {\n                            $('#' + that.cd.spaceclass + '_' + thewordnumber).addClass((that.cd.activesentence));\n                            $('#' + that.cd.wordclass + '_' + thewordnumber).addClass((that.cd.activesentence));\n                        }\n                    }\n                }\n            };\n        }//end of register events\n\n    };//end of return value\n});"],"file":"modelaudiokaraoke.min.js"}