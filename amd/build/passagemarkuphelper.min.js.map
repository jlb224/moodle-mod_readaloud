{"version":3,"file":"passagemarkuphelper.min.js","sources":["../src/passagemarkuphelper.js"],"sourcesContent":["define(['jquery', 'core/log','mod_readaloud/definitions'],\r\n    function ($, log, def) {\r\n    \"use strict\"; // jshint ;_;\r\n    /*\r\n    This file does small report\r\n     */\r\n\r\n    log.debug('Click to hear: initialising');\r\n\r\n    return {\r\n        //controls\r\n        controls: {},\r\n        //the passage (jquery object)\r\n        passage: null,\r\n        allwords: null,\r\n        allspaces: null,\r\n\r\n        //class definitions\r\n        cd: {\r\n            wordclass: def.wordclass,\r\n            spaceclass: def.spaceclass,\r\n            badwordclass: def.badwordclass,\r\n            endspaceclass: def.endspaceclass,\r\n            unreadwordclass: def.unreadwordclass,\r\n            unreadspaceclass: def.unreadspaceclass,\r\n            aiunmatched: def.aiunmatched,\r\n            passagecontainer: def.passagecontainer,\r\n            fullreportcontainer: def.fullreportcontainer,\r\n        },\r\n\r\n        //init the module\r\n        init: function(passage){\r\n            this.passage=passage;\r\n            this.allwords = this.passage.find('.' + this.cd.wordclass);\r\n            this.allspaces = this.passage.find('.' + this.cd.spaceclass);\r\n        },\r\n\r\n        clear_markup: function () {\r\n            var that = this;\r\n            that.allspaces.removeClass(that.cd.endspaceclass);\r\n            that.allspaces.removeClass(that.cd.unreadspaceclass);\r\n            that.allwords.removeClass(that.cd.aiunmatched);\r\n            that.allwords.removeClass(that.cd.unreadwordclass);\r\n            that.allwords.removeClass(that.cd.badwordclass);\r\n        },\r\n\r\n        get_word: function (wordnumber) {\r\n            return this.passage.find('.' + this.cd.wordclass + '[data-wordnumber=' + wordnumber + ']');\r\n        },\r\n\r\n        get_space: function (wordnumber) {\r\n            return this.passage.find('.' + this.cd.spaceclass + '[data-wordnumber=' + wordnumber + ']');\r\n        },\r\n\r\n        markup_passage: function (sessionmatches,sessionerrors, sessionendword) {\r\n           // this.markup_aiunmatchedwords(sessionmatches, sessionendword);\r\n            this.markup_badwords(sessionerrors);\r\n            this.markup_endword(sessionendword);\r\n            this.mark_unreadwords(sessionendword);\r\n        },\r\n\r\n        markup_badwords: function(errorwords) {\r\n            log.debug('doing bad words');\r\n            var that = this;\r\n            $.each(errorwords, function (index) {\r\n                log.debug(' bad word: index: ' + index + ' wordnumber: ' + errorwords[index].wordnumber);\r\n                that.get_word(errorwords[index].wordnumber).addClass(that.cd.badwordclass);\r\n            });\r\n        },\r\n\r\n        markup_endword: function (endwordnumber) {\r\n            var that = this;\r\n            that.get_space(endwordnumber).addClass(this.cd.endspaceclass);\r\n        },\r\n\r\n        //mark up all unmatched words as aiunmatched\r\n        markup_aiunmatchedwords: function (sessionmatches, endwordnumber) {\r\n            var that = this;\r\n            if (sessionmatches) {\r\n                var prevmatch = 0;\r\n                $.each(sessionmatches, function (index, match) {\r\n                    var unmatchedcount = index - prevmatch - 1;\r\n                    if (unmatchedcount > 0) {\r\n                        for (var errorword = 1; errorword < unmatchedcount + 1; errorword++) {\r\n                            var wordnumber = prevmatch + errorword;\r\n                            that.get_word(wordnumber).addClass(that.cd.aiunmatched);\r\n                        }\r\n                    }\r\n                    prevmatch = parseInt(index);\r\n                });\r\n\r\n                //mark all words from last matched word to the end as aiunmatched\r\n                for (var errorwordnumber = prevmatch + 1; errorwordnumber <= endwordnumber; errorwordnumber++) {\r\n                    that.get_word(errorwordnumber).addClass(that.cd.aiunmatched);\r\n                }\r\n            }\r\n        },\r\n\r\n        markup_aiunmatchedspaces: function () {\r\n            var that = this;\r\n            $('.' + this.cd.wordclass + '.' + this.cd.aiunmatched).each(function (index) {\r\n                var wordnumber = parseInt($(this).attr('data-wordnumber'));\r\n                if (that.get_word(wordnumber + 1).hasClass(that.cd.aiunmatched)) {\r\n                    that.get_word(wordnumber).addClass(that.cd.aiunmatched);\r\n                }\r\n            });\r\n        },\r\n\r\n        mark_unreadwords: function (endwordnumber) {\r\n            var that = this;\r\n            that.allwords.each(function (index) {\r\n                var wordnumber = $(this).attr('data-wordnumber');\r\n                var thespace = that.get_space(wordnumber);\r\n\r\n                if (Number(wordnumber) > Number(endwordnumber)) {\r\n                    $(this).addClass(that.cd.unreadwordclass);\r\n                    thespace.addClass(that.cd.unreadspaceclass);\r\n\r\n                    //this will clear badwords after the endmarker\r\n                    $(this).removeClass(that.cd.badwordclass);\r\n\r\n                } else {\r\n                    $(this).removeClass(that.cd.unreadwordclass);\r\n                    thespace.removeClass(that.cd.unreadspaceclass);\r\n                }\r\n            });\r\n        },\r\n    };//end of return value\r\n});"],"names":["define","$","log","def","debug","controls","passage","allwords","allspaces","cd","wordclass","spaceclass","badwordclass","endspaceclass","unreadwordclass","unreadspaceclass","aiunmatched","passagecontainer","fullreportcontainer","init","this","find","clear_markup","removeClass","get_word","wordnumber","get_space","markup_passage","sessionmatches","sessionerrors","sessionendword","markup_badwords","markup_endword","mark_unreadwords","errorwords","that","each","index","addClass","endwordnumber","markup_aiunmatchedwords","prevmatch","match","unmatchedcount","errorword","parseInt","errorwordnumber","markup_aiunmatchedspaces","attr","hasClass","thespace","Number"],"mappings":"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"}