{"version":3,"file":"multichoice.min.js","sources":["../src/multichoice.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_readaloud/definitions', 'mod_readaloud/pollyhelper','mod_readaloud/animatecss'],\r\n    function($, log, def, polly, anim) {\r\n  \"use strict\"; // jshint ;_;\r\n\r\n  /*\r\n  This file is to manage the quiz stage\r\n   */\r\n\r\n  log.debug('Readaloud Multichoice: initialising');\r\n\r\n  return {\r\n\r\n    //for making multiple instances\r\n      clone: function () {\r\n          return $.extend(true, {}, this);\r\n     },\r\n\r\n    init: function(index, itemdata, quizhelper) {\r\n      if(itemdata.hasOwnProperty('audiocontent')) {\r\n          this.prepare_audio(itemdata);\r\n      }\r\n      this.itemdata = itemdata;\r\n      this.register_events(index, itemdata, quizhelper);\r\n\r\n     //anim\r\n     var animopts = {};\r\n     animopts.useanimatecss=quizhelper.useanimatecss;\r\n     anim.init(animopts);\r\n    },\r\n\r\n    next_question: function(percent) {\r\n      var self = this;\r\n      var stepdata = {};\r\n      stepdata.index = self.index;\r\n      stepdata.hasgrade = true;\r\n      stepdata.totalitems = 1;\r\n      stepdata.correctitems = percent>0?1:0;\r\n      stepdata.grade = percent;\r\n      self.quizhelper.do_next(stepdata);\r\n    },\r\n\r\n    register_events: function(index, itemdata, quizhelper) {\r\n      var self = this;\r\n      self.index = index;\r\n      self.quizhelper = quizhelper;\r\n      var chosenelement=null;\r\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\r\n      var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .readaloud_nextbutton\");\r\n      var confirmchoicebutton = $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_confirmchoice\");\r\n      var resultspanel = $(\"#\" + itemdata.uniqueid + \"_container .readaloud_resultspanel\");\r\n      var resultspanelswish = $(\"#\" + itemdata.uniqueid + \"_container .readaloud_resultspanel_swish\");\r\n      var resultspanelstars = $(\"#\" + itemdata.uniqueid + \"_container .readaloud_swishstars\");\r\n      var resultspanelscore = $(\"#\" + itemdata.uniqueid + \"_container .readaloud_swishscore\");\r\n\r\n      nextbutton.on('click', function(e) {\r\n        self.next_question(0);\r\n      });\r\n\r\n      //if we need to submit this question we dont allow skip\r\n      if(itemdata.confirmchoice===1 || itemdata.confirmchoice==='1') {\r\n            nextbutton.hide();\r\n      }\r\n\r\n      var finalChoice = function() {\r\n          //if disabled =>just return (already answered)\r\n          if($(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_response\").hasClass('readaloud_mc_disabled')){\r\n              return;\r\n          }\r\n\r\n          //get selected item index\r\n          var checked = $(chosenelement).data('index');\r\n\r\n          //disable the answers, cos its answered\r\n          $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_response\").addClass('readaloud_mc_disabled');\r\n\r\n          //reveal answers\r\n          $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_unanswered\").hide();\r\n          $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_wrong\").show();\r\n\r\n          $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .readaloud_mc_wrong\").hide();\r\n          $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .readaloud_mc_right\").show();\r\n\r\n          //if answers were dots for audio content, show them\r\n          if(itemdata.hasOwnProperty('audiocontent')) {\r\n              for (var i = 0; i < itemdata.sentences.length; i++) {\r\n                  var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\r\n                  $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .readaloud_sentence').text(itemdata.sentences[i].sentence);\r\n              }\r\n          }\r\n\r\n          //highlight selected answers\r\n          $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('readaloud_mc_selected');\r\n\r\n          //calculate score\r\n          var achieved = checked == itemdata.correctanswer ? 1 : 0;\r\n          var percent = achieved * 100;\r\n\r\n          if(quizhelper.showqreview) {\r\n              //hide the confirm choice button\r\n              confirmchoicebutton.hide();\r\n\r\n              //show the result panel\r\n              resultspanelswish.data('possible', '1');\r\n              resultspanelswish.data('achieved', achieved);\r\n              resultspanelscore.text(achieved + '/' + 1);\r\n              if (achieved > 0) {\r\n                  resultspanelstars.html('⭐'); // Display a star\r\n              }else{\r\n                    resultspanelstars.html('❌'); // Display a cross\r\n              }\r\n              resultspanel.show();\r\n              anim.do_animate(resultspanelswish,'zoomIn animate__faster','in');\r\n\r\n              //reset the handler for a call to move to next question, this time with the score\r\n              //first unset the old button handler\r\n              nextbutton.off('click');\r\n              //then set the correct handler\r\n              nextbutton.on('click', function(e) {\r\n                  self.next_question(percent);\r\n              });\r\n              //show the next button\r\n              nextbutton.show();\r\n\r\n          }else{\r\n              $(\".readaloud_nextbutton\").prop(\"disabled\", true);\r\n              setTimeout(function() {\r\n                  $(\".readaloud_nextbutton\").prop(\"disabled\", false);\r\n                  self.next_question(percent);\r\n              }, 2000);\r\n          }\r\n      };//end of final choice\r\n\r\n\r\n\r\n      //on tapping of a response, we either action the choice or show a confirmation button\r\n      log.debug('Readaloud Multichoice: response clicked' + \"#\" + itemdata.uniqueid + \"_container .readaloud_mc_response\");\r\n      $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_response\").on('click', function(e){\r\n        log.debug('Readaloud Multichoice: response clicked');\r\n          chosenelement = this;\r\n          if(itemdata.confirmchoice===0 || itemdata.confirmchoice==='0'){\r\n              finalChoice();\r\n          }else{\r\n\r\n              //highlight selected answer\r\n              //get selected item index\r\n              var checked = $(this).data('index');\r\n              $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_response\").removeClass('readaloud_mc_selected');\r\n              $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('readaloud_mc_selected');\r\n\r\n              self.showConfirmButton(itemdata);\r\n          }\r\n      });\r\n\r\n        //on tapping of confirmation button, execute final choice\r\n        $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_confirmchoice\").on('click', function(e){\r\n                finalChoice();\r\n        });\r\n\r\n      //play audio if we are doing this as an audio player thingy\r\n        //this will use the multichoice audio content template\r\n        $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_audioplayer\").on('click', function(e) {\r\n            //if disabled =>just return (already answered)\r\n            if($(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_audioplayer\").hasClass('readaloud_mc_disabled')){\r\n                return;\r\n            }\r\n\r\n            //audio play requests\r\n            if (!self.playing) {\r\n                var el = this;\r\n                self.playing = true;\r\n                theplayer.attr('src', $(this).attr('data-src'));\r\n                theplayer[0].play();\r\n                theplayer[0].onended = function() {\r\n                    $(el).find(\".readaloud_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\r\n                    self.playing = false;\r\n                };\r\n                $(el).find(\".readaloud_mc_playstate\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\r\n            }else{\r\n                theplayer[0].pause();\r\n                theplayer[0].currentTime=0;\r\n                $(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\r\n                self.playing = false;\r\n            }\r\n        });\r\n      \r\n    },\r\n\r\n      showConfirmButton: function(itemdata) {\r\n          var confirmbutton =$(\"#\" + itemdata.uniqueid + \"_container .readaloud_mc_confirmchoice\");\r\n          anim.do_animate(confirmbutton,'zoomIn animate__faster','in');\r\n      },\r\n\r\n      prepare_audio: function(itemdata) {\r\n          // debugger;\r\n          $.each(itemdata.sentences, function(index, sentence) {\r\n              polly.fetch_polly_url(sentence.sentence, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\r\n                  $(\"#\" + itemdata.uniqueid + \"_audioplayer\" + (index+1)).attr(\"data-src\", audiourl);\r\n              });\r\n          });\r\n      }\r\n  };\r\n});"],"names":["define","$","log","def","polly","anim","debug","clone","extend","this","init","index","itemdata","quizhelper","hasOwnProperty","prepare_audio","register_events","animopts","useanimatecss","next_question","percent","stepdata","hasgrade","totalitems","correctitems","grade","do_next","self","chosenelement","theplayer","uniqueid","nextbutton","confirmchoicebutton","resultspanel","resultspanelswish","resultspanelstars","resultspanelscore","on","e","confirmchoice","hide","finalChoice","hasClass","checked","data","addClass","show","correctanswer","i","sentences","length","text","sentence","achieved","showqreview","html","do_animate","off","prop","setTimeout","removeClass","showConfirmButton","playing","pause","currentTime","el","attr","play","onended","find","confirmbutton","each","fetch_polly_url","voiceoption","usevoice","then","audiourl"],"mappings":"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"}