define ("mod_readaloud/listenandrepeat",["jquery","core/log","core/ajax","mod_readaloud/definitions","mod_readaloud/cloudpoodllloader"],function(a,b,c,d,e){"use strict";b.debug("Readaloud listen and repeat: initialising");return{activated:!1,currentSentence:"",currentAudioStart:0,currentAudioStop:0,mak:null,controls:{},results:[],init:function init(a){var b=this;e.init("readaloud_pushrecorder",function(a){switch(a.type){case"recording":break;case"speech":b.getComparison(b.currentSentence,a.capturedspeech,function(c){b.gotComparison(c,a)});break;}});b.mak=a.modelaudiokaraoke;b.prepare_controls();b.register_events();b.register_mak()},activate:function activate(){this.results=[];this.activated=!0},deactivate:function deactivate(){if(this.mak.controls.audioplayer[0].playing){this.mak.controls.audioplayer[0].pause()}this.activated=!1},prepare_controls:function prepare_controls(){var b=this;b.controls.container=a("#"+d.landrcontainer);b.controls.hiddenplayer=a("#mod_readaloud_landr_hiddenplayer");b.controls.playbutton=a("#mod_readaloud_landr_modalplay");b.controls.skipbutton=a("#mod_readaloud_landr_modalskip");b.controls.finishedbutton=a("#mod_readaloud_landr_modalfinished");b.audiourl=b.mak.fetch_audio_url();b.controls.hiddenplayer.attr("src",b.audiourl)},register_mak:function register_mak(){var c=this;c.mak.on_reach_audio_break=function(d,e,f,g){if(!c.activated){return}if(""===d.trim()){return}c.currentSentence=d;c.currentAudioStart=e.audiotime;c.currentAudioEnd=f.audiotime;b.debug(d);b.debug(e);b.debug(f);if(!(0==e.breaknumber&&!1==f)){if(f.breaknumber==g[g.length-1].breaknumber){c.controls.finishedbutton.show();c.controls.skipbutton.hide()}else{c.controls.finishedbutton.hide();c.controls.skipbutton.show()}c.mak.pause_audio();c.controls.container.modal("show");a("#mod_readaloud_modal_target_phrase").html(d.split(/ /).map(function(a,b){return"<div class=\"mod_readaloud_modal_target_word\" data-index=\""+b+"\">"+a+"</div>"}))}}},register_events:function register_events(){var a=this;a.controls.playbutton.on("click",function(){a.controls.hiddenplayer[0].currentTime=a.currentAudioStart;a.controls.hiddenplayer[0].play()});a.controls.skipbutton.on("click",function(){a.controls.container.modal("hide");if(a.controls.hiddenplayer[0].playing){a.controls.hiddenplayer[0].pause()}a.mak.play_audio()});a.controls.finishedbutton.on("click",function(){a.controls.container.modal("hide");a.mak.controls.audioplayer[0].currentTime=0});a.controls.hiddenplayer[0].ontimeupdate=function(){if(a.controls.hiddenplayer[0].currentTime>=a.currentAudioEnd){a.controls.hiddenplayer[0].pause()}}},spliton:/([,.!?:;" ])/g,gotComparison:function gotComparison(b){var c=this,d;a(".mod_readaloud_modal_target_word").removeClass("mod_readaloud_modal_target_word_correct mod_readaloud_modal_target_word_incorrect");b.forEach(function(b,c){d=b.matched?"mod_readaloud_modal_target_word_correct":"mod_readaloud_modal_target_word_incorrect";a(".mod_readaloud_modal_target_word[data-index='"+c+"']").addClass(d)})},getComparison:function getComparison(a,b,d){this;c.call([{methodname:"mod_readaloud_compare_passage_to_transcript",args:{passage:a,transcript:b,alternatives:"",language:"en-US"},done:function done(a){var b=JSON.parse(a);if(b){d(b)}else{d(!1)}},fail:function fail(a){console.log(a)}}])}}});
//# sourceMappingURL=listenandrepeat.min.js.map
