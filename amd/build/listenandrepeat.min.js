define ("mod_readaloud/listenandrepeat",["jquery","core/log","core/ajax","mod_readaloud/definitions","mod_readaloud/cloudpoodllloader"],function(a,b,c,d,e){"use strict";b.debug("Readaloud listen and repeat: initialising");return{currentSentence:"",mak:null,container:null,audiourl:!1,results:[],init:function init(b){var c=this;e.init("readaloud_pushrecorder",function(a){switch(a.type){case"recording":break;case"speech":c.getComparison(c.currentSentence,a.capturedspeech,function(b){c.gotComparison(b,a)});break;}});c.mak=b.modelaudiokaraoke;c.results=b.results;c.audiourl=c.mak.fetch_audio_url();c.container=a("#"+d.landrcontainer);c.register_events();c.register_mak()},register_mak:function register_mak(){var c=this;c.mak.on_reach_audio_break=function(d,e,f){if(""===d.trim()){return}c.currentSentence=d;b.debug(d);b.debug(e);b.debug(f);c.mak.pause_audio();c.container.modal("show");a("#mod_readaloud_modal_target_phrase").html(d)}},register_events:function register_events(){var a=this;a.container.on("hidden.bs.modal",function(){a.mak.play_audio()})},spliton:/([,.!?:;" ])/g,gotComparison:function gotComparison(a,b){this;console.log("comparison:"+JSON.stringify(a));console.log("typed:"+JSON.stringify(b))},getComparison:function getComparison(a,b,d){this;c.call([{methodname:"mod_readaloud_compare_passage_to_transcript",args:{passage:a,transcript:b,alternatives:"",language:"en-US"},done:function done(a){var b=JSON.parse(a);if(b){d(b)}else{d(!1)}},fail:function fail(a){console.log(a)}}])}}});
//# sourceMappingURL=listenandrepeat.min.js.map
