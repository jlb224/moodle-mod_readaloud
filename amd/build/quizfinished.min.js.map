{"version":3,"file":"quizfinished.min.js","sources":["../src/quizfinished.js"],"sourcesContent":["define(['jquery', 'core/log','core/modal_factory','core/str','core/modal_events',\r\n        'mod_readaloud/definitions','core/templates', 'mod_readaloud/correctionsmarkup'],\r\n    function($, log,ModalFactory, str, ModalEvents, def, templates, correctionsmarkup) {\r\n  \"use strict\"; // jshint ;_;\r\n\r\n  /*\r\n  This file is to manage the quiz stage\r\n   */\r\n\r\n  log.debug('Poodll Readaloud Quiz Finished page: initialising');\r\n\r\n  return {\r\n\r\n    strings: {},\r\n    controls: {},\r\n\r\n    //for making multiple instances\r\n      clone: function () {\r\n          return $.extend(true, {}, this);\r\n     },\r\n\r\n    init: function() {\r\n        this.init_strings();\r\n        this.register_controls();\r\n        this.register_events();\r\n\r\n    },\r\n\r\n    register_controls: function(){\r\n        this.controls.quizfinishedcontainer = $('.mod_readaloud_quiz_finished');\r\n        this.controls.quizitemscontainer = $('.mod_readaloud_quiz_items_cont');\r\n    },\r\n\r\n    register_events: function(){\r\n        var that = this;\r\n        $('body').on('click','.mod_readaloud_reattemptquiz_button',function(e) {\r\n\r\n            e.preventDefault();\r\n\r\n            //if its a reattempt, confirm and proceed\r\n            ModalFactory.create({\r\n                type: ModalFactory.types.SAVE_CANCEL,\r\n                title: that.strings.reattempttitle,\r\n                body: that.strings.reattemptbody\r\n            })\r\n            .then(function(modal) {\r\n                modal.setSaveButtonText(that.strings.reattempt);\r\n                var root = modal.getRoot();\r\n                root.on(ModalEvents.save, function() {\r\n                    that.controls.quizfinishedcontainer.hide();\r\n                    that.controls.quizitemscontainer.show();\r\n                });\r\n                modal.show();\r\n            });\r\n      });\r\n\r\n\r\n      $('body').on('click','.mod_readaloud_finishedanswerdetailslink',function(e) {\r\n          e.preventDefault();\r\n          var type = $(this).data('type');\r\n          var resultstemplate = $(this).data('resultstemplate');\r\n          var resultsdata = $(this).data('resultsdata');\r\n          var thetarget = $(this).data('target');\r\n          if(thetarget === undefined){return;}\r\n          var resultsbox = $('#' + thetarget);\r\n          if(resultsbox === undefined){return;}\r\n          if(resultsbox.is(':visible')){\r\n              resultsbox.hide();\r\n              return;\r\n          }\r\n          if(!resultsbox.is(':visible') && resultsbox.html().length > 0){\r\n              resultsbox.show();\r\n              return;\r\n          }\r\n          //otherwise load the results and show the box\r\n          templates.render('mod_readaloud/' + resultstemplate, resultsdata).then(\r\n              function(html,js){\r\n                  resultsbox.html(html);\r\n                  //do corrections markup .. if we have them\r\n                  if(resultsdata.hasOwnProperty('grammarerrors')){\r\n                      correctionsmarkup.init({ \"correctionscontainer\": resultsbox,\r\n                          \"grammarerrors\": resultsdata.grammarerrors,\r\n                          \"grammarmatches\": resultsdata.grammarmatches,\r\n                          \"insertioncount\": resultsdata.insertioncount});\r\n                  }\r\n                  //do passage results\r\n                  if(resultsdata.hasOwnProperty('unreached')){\r\n                      passagereading.doComparisonMarkup(resultsdata.comparison,thetarget);\r\n                  }\r\n\r\n                  //show and hide\r\n                  resultsbox.show();\r\n                  templates.runTemplateJS(js);\r\n              }\r\n          );// End of templates\r\n      });\r\n    },\r\n\r\n    init_strings: function(){\r\n        var that = this;\r\n        // set up strings\r\n        str.get_strings([\r\n            {\"key\": \"reattempttitle\",       \"component\": 'mod_readaloud'},\r\n            {\"key\": \"reattemptbody\",           \"component\": 'mod_readaloud'},\r\n            {\"key\": \"reattempt\",           \"component\": 'mod_readaloud'}\r\n\r\n        ]).done(function(s) {\r\n            var i = 0;\r\n            that.strings.reattempttitle = s[i++];\r\n            that.strings.reattemptbody = s[i++];\r\n            that.strings.reattempt = s[i++];\r\n        });\r\n    }\r\n  };\r\n});"],"names":["define","$","log","ModalFactory","str","ModalEvents","def","templates","correctionsmarkup","debug","strings","controls","clone","extend","this","init","init_strings","register_controls","register_events","quizfinishedcontainer","quizitemscontainer","that","on","e","preventDefault","create","type","types","SAVE_CANCEL","title","reattempttitle","body","reattemptbody","then","modal","setSaveButtonText","reattempt","getRoot","save","hide","show","data","resultstemplate","resultsdata","thetarget","undefined","resultsbox","is","html","length","render","js","hasOwnProperty","grammarerrors","grammarmatches","insertioncount","passagereading","doComparisonMarkup","comparison","runTemplateJS","get_strings","done","s","i"],"mappings":"AAAAA,oCAAO,CAAC,SAAU,WAAW,qBAAqB,WAAW,oBACrD,4BAA4B,iBAAkB,oCAClD,SAASC,EAAGC,IAAIC,aAAcC,IAAKC,YAAaC,IAAKC,UAAWC,0BAOlEN,IAAIO,MAAM,qDAEH,CAELC,QAAS,GACTC,SAAU,GAGRC,MAAO,kBACIX,EAAEY,QAAO,EAAM,GAAIC,OAGhCC,KAAM,gBACGC,oBACAC,yBACAC,mBAITD,kBAAmB,gBACVN,SAASQ,sBAAwBlB,EAAE,qCACnCU,SAASS,mBAAqBnB,EAAE,mCAGzCiB,gBAAiB,eACTG,KAAOP,KACXb,EAAE,QAAQqB,GAAG,QAAQ,uCAAsC,SAASC,GAEhEA,EAAEC,iBAGFrB,aAAasB,OAAO,CAChBC,KAAMvB,aAAawB,MAAMC,YACzBC,MAAOR,KAAKX,QAAQoB,eACpBC,KAAMV,KAAKX,QAAQsB,gBAEtBC,MAAK,SAASC,OACXA,MAAMC,kBAAkBd,KAAKX,QAAQ0B,WAC1BF,MAAMG,UACZf,GAAGjB,YAAYiC,MAAM,WACtBjB,KAAKV,SAASQ,sBAAsBoB,OACpClB,KAAKV,SAASS,mBAAmBoB,UAErCN,MAAMM,aAKhBvC,EAAE,QAAQqB,GAAG,QAAQ,4CAA2C,SAASC,GACrEA,EAAEC,iBACSvB,EAAEa,MAAM2B,KAAK,YACpBC,gBAAkBzC,EAAEa,MAAM2B,KAAK,mBAC/BE,YAAc1C,EAAEa,MAAM2B,KAAK,eAC3BG,UAAY3C,EAAEa,MAAM2B,KAAK,kBACZI,IAAdD,eACCE,WAAa7C,EAAE,IAAM2C,gBACPC,IAAfC,aACAA,WAAWC,GAAG,YACbD,WAAWP,QAGXO,WAAWC,GAAG,aAAeD,WAAWE,OAAOC,OAAS,EACxDH,WAAWN,OAIfjC,UAAU2C,OAAO,iBAAmBR,gBAAiBC,aAAaV,MAC9D,SAASe,KAAKG,IACVL,WAAWE,KAAKA,MAEbL,YAAYS,eAAe,kBAC1B5C,kBAAkBO,KAAK,sBAA0B+B,yBAC5BH,YAAYU,6BACXV,YAAYW,8BACZX,YAAYY,iBAGnCZ,YAAYS,eAAe,cAC1BI,eAAeC,mBAAmBd,YAAYe,WAAWd,WAI7DE,WAAWN,OACXjC,UAAUoD,cAAcR,aAMtCnC,aAAc,eACNK,KAAOP,KAEXV,IAAIwD,YAAY,CACZ,KAAQ,2BAAqC,iBAC7C,KAAQ,0BAAwC,iBAChD,KAAQ,sBAAoC,mBAE7CC,MAAK,SAASC,OACTC,EAAI,EACR1C,KAAKX,QAAQoB,eAAiBgC,EAAEC,KAChC1C,KAAKX,QAAQsB,cAAgB8B,EAAEC,KAC/B1C,KAAKX,QAAQ0B,UAAY0B,EAAEC"}